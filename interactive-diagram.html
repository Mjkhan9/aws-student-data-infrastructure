<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Interactive Architecture | AWS Student Data Infrastructure</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <style>
        /* Fixed layout - proper structure */
        .diagram-page-layout {
            display: grid;
            grid-template-columns: 320px 1fr;
            gap: 16px;
            min-height: 600px;
        }
        
        /* Left sidebar - tier cards */
        .tier-sidebar {
            background: var(--aws-panel-bg);
            border: 1px solid var(--aws-border);
            border-radius: var(--aws-radius);
            padding: 16px;
        }
        
        .tier-sidebar h3 {
            font-size: 13px;
            color: var(--aws-text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            font-weight: 700;
        }
        
        /* Main diagram canvas - structured */
        .diagram-canvas {
            background: var(--aws-panel-bg);
            border: 1px solid var(--aws-border);
            border-radius: var(--aws-radius);
            padding: 16px;
            position: relative;
            min-height: 600px;
        }
        
        .diagram-header {
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--aws-border);
        }
        
        .diagram-header h2 {
            font-size: 18px;
            color: var(--aws-text-primary);
            margin: 0;
            font-weight: 700;
            border: none;
            padding: 0;
        }
        
        .diagram-subtitle {
            font-size: 12px;
            color: var(--aws-text-tertiary);
            margin-top: 4px;
        }
        
        /* Blueprint grid background */
        .diagram-viewport {
            position: relative;
            min-height: 500px;
            background-image: 
                linear-gradient(rgba(59, 130, 246, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(59, 130, 246, 0.03) 1px, transparent 1px);
            background-size: 20px 20px;
            border-radius: var(--aws-radius);
        }
        
        /* Tier cards - FIXED COLORS (darkened to match theme) */
        .vpc-tier {
            background: var(--aws-card-bg);
            border: 2px solid;
            border-radius: var(--aws-radius);
            padding: 12px;
            margin-bottom: 12px;
            transition: all 0.15s ease;
            cursor: pointer;
        }
        
        .vpc-tier:hover {
            background: #2a3441;
            transform: translateX(2px);
        }
        
        /* Darkened pastel colors to match dark theme */
        .tier-internet {
            border-color: #b8860b;
            background: rgba(184, 134, 11, 0.08);
        }
        
        .tier-admin {
            border-color: #4a7cb8;
            background: rgba(74, 124, 184, 0.08);
        }
        
        .tier-app {
            border-color: #6b5ba3;
            background: rgba(107, 91, 163, 0.08);
        }
        
        .tier-db {
            border-color: #b84a7c;
            background: rgba(184, 74, 124, 0.08);
        }
        
        .tier-s3 {
            border-color: #2d8659;
            background: rgba(45, 134, 89, 0.08);
        }
        
        .tier-security {
            border-color: var(--aws-orange);
            background: rgba(255, 153, 0, 0.08);
        }
        
        .vpc-tier-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--aws-text-primary);
            margin-bottom: 4px;
        }
        
        .vpc-tier-cidr {
            font-size: 12px;
            color: var(--aws-text-tertiary);
            font-family: Monaco, monospace;
        }
        
        /* Info panel - FIXED STYLING (no glowing teal) */
        .info-panel {
            background: var(--aws-card-bg);
            border: 1px solid var(--aws-border);
            border-left: 3px solid var(--aws-blue);
            border-radius: var(--aws-radius);
            padding: 16px;
            margin-top: 16px;
            display: none;
        }
        
        .info-panel.visible {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .info-panel h3 {
            color: var(--aws-blue);
            font-size: 16px;
            margin-bottom: 12px;
            border: none;
            padding: 0;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 12px;
        }
        
        .info-item {
            background: var(--aws-panel-bg);
            padding: 10px;
            border-radius: var(--aws-radius);
            border: 1px solid var(--aws-border);
        }
        
        .info-label {
            font-size: 11px;
            color: var(--aws-text-tertiary);
            font-weight: 700;
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .info-value {
            color: var(--aws-text-primary);
            font-weight: 500;
            font-size: 13px;
        }
        
        .sg-rules {
            background: var(--aws-panel-bg);
            padding: 10px;
            border-radius: var(--aws-radius);
            margin-top: 12px;
            border: 1px solid var(--aws-border);
        }
        
        .sg-rule {
            padding: 6px;
            background: var(--aws-card-bg);
            margin: 4px 0;
            border-left: 2px solid var(--aws-green);
            font-family: Monaco, monospace;
            font-size: 12px;
            color: var(--aws-text-secondary);
        }
        
        .legend {
            display: flex;
            gap: 16px;
            justify-content: flex-start;
            margin-top: 12px;
            flex-wrap: wrap;
            padding: 12px;
            background: var(--aws-panel-bg);
            border: 1px solid var(--aws-border);
            border-radius: var(--aws-radius);
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
        }
        
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: var(--aws-radius);
            border: 2px solid currentColor;
        }
        
        @media (max-width: 1024px) {
            .diagram-page-layout {
                grid-template-columns: 1fr;
            }
            
            .info-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
<header class="site-header">
    <div>
        <div class="logo">AWS Student Data Infrastructure</div>
        <nav class="nav-links">
            <a href="index.html">Home</a>
            <a href="architecture.html">Architecture</a>
            <a href="automation.html">IAM Automation</a>
            <a href="docs.html">Documentation</a>
            <a href="review.html">Faculty Review</a>
            <a href="live-demo.html">Live Demo</a>
            <a href="interactive-diagram.html" class="active">Interactive Diagram</a>
            <a href="cost-calculator.html">Cost Calculator</a>
            <a href="security-simulator.html">Security Simulator</a>
        </nav>
    </div>
</header>

<main class="content">
    <section class="card">
        <h1>Interactive VPC Architecture</h1>
        <p>
            Click on any network tier to see detailed configuration, security rules, and role in the 
            three-tier architecture. This visualization demonstrates defense-in-depth security design 
            for student data protection.
        </p>
    </section>

    <div class="diagram-page-layout">
        <!-- Left sidebar with tier cards -->
        <aside class="tier-sidebar">
            <h3>Network Tiers</h3>
            
            <div class="vpc-tier tier-internet" data-component="internet">
                <div class="vpc-tier-title">Internet Gateway</div>
                <div class="vpc-tier-cidr">Public Access</div>
            </div>
            
            <div class="vpc-tier tier-admin" data-component="admin-tier">
                <div class="vpc-tier-title">Admin Tier</div>
                <div class="vpc-tier-cidr">172.32.1.0/24</div>
            </div>
            
            <div class="vpc-tier tier-app" data-component="app-tier">
                <div class="vpc-tier-title">Application Tier</div>
                <div class="vpc-tier-cidr">172.32.10.0/24</div>
            </div>
            
            <div class="vpc-tier tier-db" data-component="db-tier">
                <div class="vpc-tier-title">Database Tier</div>
                <div class="vpc-tier-cidr">172.32.20.0/24</div>
            </div>
            
            <div class="vpc-tier tier-s3" data-component="s3-bucket">
                <div class="vpc-tier-title">S3 Storage</div>
                <div class="vpc-tier-cidr">Encrypted Buckets</div>
            </div>
            
            <div class="vpc-tier tier-security" data-component="security">
                <div class="vpc-tier-title">Security & Logging</div>
                <div class="vpc-tier-cidr">CloudTrail + Flow Logs</div>
            </div>
        </aside>

        <!-- Main diagram canvas -->
        <div class="diagram-canvas">
            <div class="diagram-header">
                <h2>VPC Architecture: 172.32.0.0/16</h2>
                <div class="diagram-subtitle">Multi-tier network isolation with zero-trust security</div>
            </div>
            
            <div class="diagram-viewport">
                <svg width="100%" height="500" viewBox="0 0 900 500" style="display: block;">
                    <!-- VPC Container -->
                    <rect x="20" y="20" width="860" height="460" fill="none" stroke="#3b82f6" stroke-width="2" rx="4"/>
                    <text x="450" y="50" text-anchor="middle" font-size="16" fill="#d5dbdb" font-weight="700">
                        VPC: 172.32.0.0/16
                    </text>
                    
                    <!-- Admin Tier -->
                    <rect x="50" y="80" width="250" height="100" fill="rgba(74, 124, 184, 0.15)" stroke="#4a7cb8" stroke-width="2" rx="3"/>
                    <text x="175" y="105" text-anchor="middle" font-size="14" fill="#d5dbdb" font-weight="700">Admin Tier (Public)</text>
                    <text x="175" y="125" text-anchor="middle" font-size="12" fill="#aab7b8">172.32.1.0/24</text>
                    <text x="175" y="145" text-anchor="middle" font-size="11" fill="#aab7b8">Bastion • NAT Gateway</text>
                    <text x="175" y="165" text-anchor="middle" font-size="11" fill="#aab7b8">Corporate IP Only</text>
                    
                    <!-- App Tier -->
                    <rect x="50" y="200" width="250" height="100" fill="rgba(107, 91, 163, 0.15)" stroke="#6b5ba3" stroke-width="2" rx="3"/>
                    <text x="175" y="225" text-anchor="middle" font-size="14" fill="#d5dbdb" font-weight="700">Application Tier (Private)</text>
                    <text x="175" y="245" text-anchor="middle" font-size="12" fill="#aab7b8">172.32.10.0/24</text>
                    <text x="175" y="265" text-anchor="middle" font-size="11" fill="#aab7b8">ECS Fargate • ALB</text>
                    <text x="175" y="285" text-anchor="middle" font-size="11" fill="#aab7b8">NAT Outbound Only</text>
                    
                    <!-- DB Tier -->
                    <rect x="50" y="320" width="250" height="100" fill="rgba(184, 74, 124, 0.15)" stroke="#b84a7c" stroke-width="2" rx="3"/>
                    <text x="175" y="345" text-anchor="middle" font-size="14" fill="#d5dbdb" font-weight="700">Database Tier (Isolated)</text>
                    <text x="175" y="365" text-anchor="middle" font-size="12" fill="#aab7b8">172.32.20.0/24</text>
                    <text x="175" y="385" text-anchor="middle" font-size="11" fill="#aab7b8">RDS PostgreSQL</text>
                    <text x="175" y="405" text-anchor="middle" font-size="11" fill="#aab7b8">No Internet Access</text>
                    
                    <!-- S3 Storage -->
                    <rect x="350" y="200" width="250" height="100" fill="rgba(45, 134, 89, 0.15)" stroke="#2d8659" stroke-width="2" rx="3"/>
                    <text x="475" y="225" text-anchor="middle" font-size="14" fill="#d5dbdb" font-weight="700">S3 Storage</text>
                    <text x="475" y="245" text-anchor="middle" font-size="12" fill="#aab7b8">student-data-reports</text>
                    <text x="475" y="265" text-anchor="middle" font-size="11" fill="#aab7b8">SSE-KMS Encrypted</text>
                    <text x="475" y="285" text-anchor="middle" font-size="11" fill="#aab7b8">VPC Endpoint Access</text>
                    
                    <!-- Security & Logging -->
                    <rect x="630" y="80" width="230" height="120" fill="rgba(255, 153, 0, 0.10)" stroke="#ff9900" stroke-width="2" rx="3"/>
                    <text x="745" y="105" text-anchor="middle" font-size="14" fill="#d5dbdb" font-weight="700">Security & Audit</text>
                    <text x="745" y="130" text-anchor="middle" font-size="11" fill="#aab7b8">CloudTrail All Regions</text>
                    <text x="745" y="150" text-anchor="middle" font-size="11" fill="#aab7b8">VPC Flow Logs</text>
                    <text x="745" y="170" text-anchor="middle" font-size="11" fill="#aab7b8">GuardDuty Active</text>
                    <text x="745" y="190" text-anchor="middle" font-size="11" fill="#aab7b8">KMS Encryption</text>
                    
                    <!-- Traffic Flow Arrows -->
                    <defs>
                        <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <polygon points="0 0, 10 3, 0 6" fill="#64748b"/>
                        </marker>
                    </defs>
                    
                    <line x1="175" y1="180" x2="175" y2="200" stroke="#64748b" stroke-width="2" marker-end="url(#arrowhead)"/>
                    <line x1="175" y1="300" x2="175" y2="320" stroke="#64748b" stroke-width="2" marker-end="url(#arrowhead)"/>
                    <line x1="300" y1="250" x2="350" y2="250" stroke="#64748b" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead)"/>
                </svg>
            </div>
            
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="color: #4a7cb8;"></div>
                    <span>Public Tier (Internet Gateway)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="color: #6b5ba3;"></div>
                    <span>Private Tier (NAT Gateway)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="color: #b84a7c;"></div>
                    <span>Isolated Tier (No Internet)</span>
                </div>
            </div>
        </div>
    </div>

    <div id="infoPanel" class="info-panel"></div>
</main>

<footer class="site-footer">
    <p>Interactive VPC Architecture • AWS Student Data Infrastructure • 2025</p>
</footer>

<script>
const componentInfo = {
    "internet": {
        title: "Internet Gateway",
        description: "Public entry point allowing controlled access to admin tier resources through corporate IP restrictions.",
        details: {
            "Type": "Internet Gateway",
            "Attached To": "VPC 172.32.0.0/16",
            "Route Target": "Admin subnet only",
            "Access Control": "Corporate IP whitelist",
            "Usage": "Bastion host access, NAT Gateway"
        },
        securityRules: [
            "Only admin subnet has IGW route",
            "All other subnets use NAT for outbound",
            "No direct internet access to workloads",
            "Network ACLs restrict inbound traffic"
        ]
    },
    "admin-tier": {
        title: "Admin Tier (Public Subnets)",
        description: "Public-facing administrative layer providing secure access to internal resources through hardened bastion hosts.",
        details: {
            "Subnets": "admin-az1a (172.32.1.0/24), admin-az1b (172.32.2.0/24)",
            "Availability Zones": "us-east-1a, us-east-1b",
            "Internet Access": "Internet Gateway attached",
            "NAT Gateways": "One per AZ for outbound traffic",
            "Route Table": "Public (0.0.0.0/0 → IGW)",
            "Components": "Bastion hosts, VPN endpoints"
        },
        securityRules: [
            "Ingress: TCP 22 from corporate IP ranges only",
            "Ingress: TCP 443 from VPN CIDR only",
            "Egress: TCP 22/443 to application tier",
            "NACL: Deny all by default, explicit allows only"
        ]
    },
    "app-tier": {
        title: "Application Tier (Private Subnets)",
        description: "Private application layer hosting containerized workloads with no direct internet access.",
        details: {
            "Subnets": "app-az1a (172.32.10.0/24), app-az1b (172.32.11.0/24)",
            "Availability Zones": "us-east-1a, us-east-1b",
            "Internet Access": "Outbound only via NAT Gateway",
            "Compute": "ECS Fargate, Lambda functions",
            "Load Balancer": "Application Load Balancer (HTTPS)",
            "Route Table": "Private (0.0.0.0/0 → NAT)"
        },
        securityRules: [
            "Ingress: TCP 22 from bastion-sg only",
            "Ingress: TCP 8443 from alb-sg only",
            "Egress: TCP 5432 to db-sg only",
            "Egress: TCP 443 to 0.0.0.0/0 (via NAT)",
            "Security Group: SG-to-SG referencing"
        ]
    },
    "db-tier": {
        title: "Database Tier (Isolated Subnets)",
        description: "Fully isolated database layer with no internet routing. RDS instances accept connections only from application tier.",
        details: {
            "Subnets": "db-az1a (172.32.20.0/24), db-az1b (172.32.21.0/24)",
            "Availability Zones": "us-east-1a, us-east-1b",
            "Internet Access": "None (no route to internet)",
            "Database": "RDS PostgreSQL 15.3 Multi-AZ",
            "Instance Type": "db.r6g.xlarge (16 GB RAM)",
            "Encryption": "KMS customer-managed key (AES-256)",
            "Backups": "Automated daily + 30-day retention"
        },
        securityRules: [
            "Ingress: TCP 5432 from app-sg ONLY",
            "Egress: None (stateful response traffic only)",
            "NACL: Deny all except app subnet CIDR",
            "No public IP addresses assigned",
            "SSL/TLS required for all connections"
        ]
    },
    "s3-bucket": {
        title: "S3 Storage (Encrypted Exports)",
        description: "Encrypted object storage for student data exports with versioning and cross-region replication.",
        details: {
            "Bucket Name": "student-data-reports-production",
            "Encryption": "SSE-KMS (customer-managed key)",
            "Versioning": "Enabled (all versions retained)",
            "Public Access": "Blocked at account and bucket level",
            "Replication": "Cross-region to us-west-2",
            "Access Logging": "All requests logged",
            "Lifecycle": "Transition to Glacier after 90 days"
        },
        securityRules: [
            "Bucket policy: Deny all public access",
            "IAM policy: Tag-based access control",
            "Condition: Require MFA for deletion",
            "VPC Endpoint: Private S3 access only",
            "Object Lock: WORM mode for compliance"
        ]
    },
    "security": {
        title: "Security & Audit Logging",
        description: "Comprehensive logging capturing all API calls, network traffic, and security events.",
        details: {
            "CloudTrail": "Management + data events logged",
            "VPC Flow Logs": "1-minute intervals to S3",
            "GuardDuty": "Threat detection enabled",
            "Log Retention": "CloudTrail 90d, VPC 30d",
            "Integrity": "Log file validation enabled",
            "Encryption": "Dedicated KMS key for logs"
        },
        securityRules: [
            "CloudTrail: All IAM, RDS, S3, VPC events",
            "VPC Flow Logs: Accepted and rejected traffic",
            "GuardDuty: Analyzes logs for threats",
            "SNS Alerts: Critical findings trigger notifications",
            "S3 Bucket Policy: Prevents log deletion"
        ]
    }
};

document.querySelectorAll(".vpc-tier").forEach(tier => {
    tier.addEventListener("click", function(e) {
        e.stopPropagation();
        
        document.querySelectorAll(".vpc-tier").forEach(t => t.style.borderWidth = "2px");
        this.style.borderWidth = "3px";
        
        const componentType = this.dataset.component;
        const info = componentInfo[componentType];
        
        if (info) {
            displayInfo(info);
        }
    });
});

function displayInfo(info) {
    const panel = document.getElementById("infoPanel");
    
    let detailsHTML = '<div class="info-grid">';
    for (const [label, value] of Object.entries(info.details)) {
        detailsHTML += `
            <div class="info-item">
                <div class="info-label">${label}</div>
                <div class="info-value">${value}</div>
            </div>
        `;
    }
    detailsHTML += "</div>";
    
    let rulesHTML = "";
    if (info.securityRules && info.securityRules.length > 0) {
        rulesHTML = '<div class="sg-rules"><strong style="color: var(--aws-text-primary); font-size: 13px;">Security Controls:</strong>';
        info.securityRules.forEach(rule => {
            rulesHTML += `<div class="sg-rule">✓ ${rule}</div>`;
        });
        rulesHTML += "</div>";
    }
    
    panel.innerHTML = `
        <h3>${info.title}</h3>
        <p style="color: var(--aws-text-secondary); margin-bottom: 12px; font-size: 13px;">${info.description}</p>
        ${detailsHTML}
        ${rulesHTML}
    `;
    
    panel.classList.add("visible");
    panel.scrollIntoView({ behavior: "smooth", block: "nearest" });
}

document.addEventListener("click", function(e) {
    if (!e.target.closest(".vpc-tier") && !e.target.closest(".info-panel")) {
        document.querySelectorAll(".vpc-tier").forEach(t => t.style.borderWidth = "2px");
    }
});
</script>
</body>
</html>
