<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Live IAM Demo | AWS Student Data Infrastructure</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <style>
        /* Live Demo - AWS Console Style */
        .demo-page .content {
            padding-top: 8px !important;
        }
        
        .demo-page .card {
            margin-top: 8px !important;
            padding-top: 12px !important;
            padding-bottom: 12px !important;
        }
        
        .demo-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-top: 12px;
        }
        
        .run-button-container {
            text-align: center;
            padding: 32px 0;
            background: var(--aws-panel-bg);
            border: 1px solid var(--aws-border);
            border-radius: var(--aws-radius);
            margin-bottom: 16px;
        }
        
        .run-button {
            background: var(--aws-orange);
            color: white;
            border: none;
            padding: 16px 40px;
            font-size: 16px;
            font-weight: 700;
            border-radius: var(--aws-radius);
            cursor: pointer;
            transition: all 0.15s ease;
            font-family: inherit;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .run-button:hover:not(:disabled) {
            background: #e88b00;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        .run-button:disabled {
            background: var(--aws-border);
            cursor: not-allowed;
            opacity: 0.5;
        }
        
        .console-output {
            background: var(--aws-card-bg);
            border: 1px solid var(--aws-border);
            border-radius: var(--aws-radius);
            padding: 16px;
        }
        
        .console-output h2 {
            font-size: 16px;
            color: var(--aws-text-primary);
            margin-bottom: 12px;
            font-weight: 700;
            border: none;
            padding: 0;
        }
        
        .console-window {
            background: #0d1117;
            border: 1px solid var(--aws-border);
            border-radius: var(--aws-radius);
            padding: 16px;
            min-height: 400px;
            max-height: 500px;
            overflow-y: auto;
            font-family: Monaco, Consolas, monospace;
            font-size: 12px;
            line-height: 1.6;
        }
        
        .log-line {
            margin: 2px 0;
            opacity: 0;
            animation: fadeIn 0.3s forwards;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .log-info { color: #58a6ff; }
        .log-success { color: #3fb950; }
        .log-warning { color: #d29922; }
        .log-error { color: #f85149; }
        .log-dim { color: #8b949e; }
        
        .iam-state {
            background: var(--aws-card-bg);
            border: 1px solid var(--aws-border);
            border-radius: var(--aws-radius);
            padding: 16px;
        }
        
        .iam-state h2 {
            font-size: 16px;
            color: var(--aws-text-primary);
            margin-bottom: 12px;
            font-weight: 700;
            border: none;
            padding: 0;
        }
        
        .state-section {
            background: var(--aws-panel-bg);
            border: 1px solid var(--aws-border);
            border-radius: var(--aws-radius);
            padding: 12px;
            margin-bottom: 12px;
        }
        
        .state-section h3 {
            font-size: 11px;
            color: var(--aws-text-tertiary);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
            border: none;
        }
        
        .state-item {
            background: var(--aws-card-bg);
            border-left: 3px solid var(--aws-green);
            padding: 8px 12px;
            margin: 4px 0;
            border-radius: var(--aws-radius);
            font-size: 12px;
        }
        
        .state-item.pending {
            border-left-color: var(--aws-text-tertiary);
            opacity: 0.5;
        }
        
        .state-empty {
            color: var(--aws-text-tertiary);
            font-style: italic;
            font-size: 12px;
            padding: 8px;
        }
        
        @media (max-width: 1024px) {
            .demo-layout {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body class="demo-page">
<header class="site-header">
    <div>
        <div class="logo">AWS Student Data Infrastructure</div>
        <nav class="nav-links">
            <a href="index.html">Home</a>
            <a href="architecture.html">Architecture</a>
            <a href="automation.html">IAM Automation</a>
            <a href="docs.html">Documentation</a>
            <a href="review.html">Faculty Review</a>
            <a href="live-demo.html" class="active">Live Demo</a>
            <a href="interactive-diagram.html">Interactive Diagram</a>
            <a href="cost-calculator.html">Cost Calculator</a>
            <a href="security-simulator.html">Security Simulator</a>
        </nav>
    </div>
</header>

<main class="content">
    <section class="card">
        <h1>Live IAM Automation Demo</h1>
        <p>
            Watch the IAM provisioning pipeline execute in real-time in your browser. This demonstration 
            simulates the production automation workflow including group validation, policy attachment, 
            user creation, and compliance reporting. No AWS credentials required.
        </p>
    </section>

    <div class="run-button-container">
        <button id="runButton" class="run-button" onclick="runDemo()">
            ▶ Run IAM Automation
        </button>
    </div>

    <div class="demo-layout">
        <div class="console-output">
            <h2>Console Output</h2>
            <div id="consoleWindow" class="console-window"></div>
        </div>
        
        <div class="iam-state">
            <h2>IAM State</h2>
            
            <div class="state-section">
                <h3>IAM Groups</h3>
                <div id="groupsList" class="state-empty">Groups will appear here...</div>
            </div>
            
            <div class="state-section">
                <h3>Provisioned Users</h3>
                <div id="usersList" class="state-empty">Users will appear here...</div>
            </div>
            
            <div class="state-section">
                <h3>Applied Policies</h3>
                <div id="policiesList" class="state-empty">Policies will appear here...</div>
            </div>
        </div>
    </div>
</main>

<footer class="site-footer">
    <p>Live IAM Automation Demo • AWS Student Data Infrastructure • 2025</p>
</footer>

<script>
let isRunning = false;

function log(message, type = 'info') {
    const consoleWindow = document.getElementById('consoleWindow');
    const line = document.createElement('div');
    line.className = `log-line log-${type}`;
    line.textContent = message;
    consoleWindow.appendChild(line);
    consoleWindow.scrollTop = consoleWindow.scrollHeight;
}

function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}

function addStateItem(listId, content, pending = false) {
    const list = document.getElementById(listId);
    if (list.querySelector('.state-empty')) {
        list.innerHTML = '';
    }
    const item = document.createElement('div');
    item.className = pending ? 'state-item pending' : 'state-item';
    item.textContent = content;
    list.appendChild(item);
    return item;
}

async function runDemo() {
    if (isRunning) return;
    isRunning = true;
    
    const button = document.getElementById('runButton');
    button.disabled = true;
    button.textContent = '⏳ Running...';
    
    document.getElementById('consoleWindow').innerHTML = '';
    document.getElementById('groupsList').innerHTML = '<div class="state-empty">Groups will appear here...</div>';
    document.getElementById('usersList').innerHTML = '<div class="state-empty">Users will appear here...</div>';
    document.getElementById('policiesList').innerHTML = '<div class="state-empty">Policies will appear here...</div>';
    
    log('═══════════════════════════════════════════════', 'dim');
    log('IAM AUTOMATION PIPELINE v2.1.0', 'info');
    log('University of Houston Student Data Infrastructure', 'dim');
    log('═══════════════════════════════════════════════', 'dim');
    await sleep(800);
    
    log('[INIT] Initializing IAM automation workflow...', 'info');
    await sleep(600);
    log('[INIT] Loading configuration from provisioning.yaml', 'dim');
    await sleep(500);
    log('[INIT] Validating AWS credentials... ✓', 'success');
    await sleep(700);
    
    log('[GROUPS] Creating IAM groups...', 'info');
    await sleep(600);
    
    const groups = [
        'StudentDataReadOnly',
        'StudentDataAdmin', 
        'ReportsGeneration',
        'AuditViewers'
    ];
    
    for (const group of groups) {
        log(`[GROUPS] Creating group: ${group}`, 'dim');
        addStateItem('groupsList', group);
        await sleep(500);
        log(`[GROUPS] ✓ ${group} created successfully`, 'success');
        await sleep(400);
    }
    
    log('[POLICY] Attaching managed policies to groups...', 'info');
    await sleep(600);
    
    const policies = [
        'AmazonS3ReadOnlyAccess → StudentDataReadOnly',
        'StudentDataCustomPolicy → StudentDataAdmin',
        'CloudWatchLogsReadOnlyAccess → AuditViewers'
    ];
    
    for (const policy of policies) {
        log(`[POLICY] Attaching: ${policy}`, 'dim');
        addStateItem('policiesList', policy.split(' → ')[0]);
        await sleep(500);
        log(`[POLICY] ✓ Policy attached successfully`, 'success');
        await sleep(400);
    }
    
    log('[USERS] Provisioning IAM users...', 'info');
    await sleep(600);
    
    const users = [
        { name: 'john.smith', group: 'StudentDataReadOnly' },
        { name: 'sarah.johnson', group: 'StudentDataAdmin' },
        { name: 'mike.williams', group: 'ReportsGeneration' }
    ];
    
    for (const user of users) {
        log(`[USERS] Creating user: ${user.name}`, 'dim');
        await sleep(500);
        log(`[USERS] Adding ${user.name} to ${user.group}`, 'dim');
        addStateItem('usersList', `${user.name} (${user.group})`);
        await sleep(500);
        log(`[USERS] ✓ ${user.name} provisioned successfully`, 'success');
        await sleep(400);
    }
    
    log('[TAGS] Applying resource tags...', 'info');
    await sleep(600);
    log('[TAGS] Environment: Production', 'dim');
    await sleep(300);
    log('[TAGS] Project: StudentDataInfrastructure', 'dim');
    await sleep(300);
    log('[TAGS] ManagedBy: Automation', 'dim');
    await sleep(500);
    log('[TAGS] ✓ Tags applied successfully', 'success');
    await sleep(700);
    
    log('[AUDIT] Generating CloudTrail compliance report...', 'info');
    await sleep(800);
    log('[AUDIT] ✓ All actions logged to CloudTrail', 'success');
    await sleep(500);
    
    log('[VALIDATE] Running post-provisioning validation...', 'info');
    await sleep(700);
    log('[VALIDATE] ✓ All users have MFA enforcement', 'success');
    await sleep(400);
    log('[VALIDATE] ✓ Password policy meets requirements', 'success');
    await sleep(400);
    log('[VALIDATE] ✓ No overly permissive policies detected', 'success');
    await sleep(700);
    
    log('═══════════════════════════════════════════════', 'dim');
    log('✓ PROVISIONING COMPLETE', 'success');
    log(`Total users created: ${users.length}`, 'info');
    log(`Total groups created: ${groups.length}`, 'info');
    log(`Execution time: 12.3 seconds`, 'info');
    log(`Error rate: 0%`, 'success');
    log('═══════════════════════════════════════════════', 'dim');
    
    button.disabled = false;
    button.textContent = '▶ Run IAM Automation';
    isRunning = false;
}
</script>
</body>
</html>
