<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Security Simulator | AWS Student Data Infrastructure</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Interactive security simulator demonstrating how AWS protects student data from cyber attacks.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%23232f3e' width='100' height='100' rx='8'/><text y='.9em' x='50%' text-anchor='middle' font-size='70' fill='%23ff9900'>‚òÅ</text></svg>">
    <style>
        :root {
            --aws-navy: #232f3e;
            --aws-navy-light: #2a3f54;
            --aws-orange: #ff9900;
            --aws-orange-hover: #ec7211;
            --bg-primary: #f8f9fa;
            --bg-white: #ffffff;
            --bg-dark: #1a1a2e;
            --border-light: #e8eaed;
            --border-medium: #d1d5db;
            --text-primary: #16191f;
            --text-secondary: #5f6b7a;
            --text-muted: #8c939d;
            --success-green: #067d68;
            --success-bg: #d4edda;
            --danger-red: #d13212;
            --danger-bg: #f8d7da;
            --warning-orange: #b45309;
            --warning-bg: #fff3cd;
            --info-blue: #0073bb;
            --info-bg: #d1ecf1;
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.12);
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            --font-mono: 'IBM Plex Mono', monospace;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-sans);
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }

        /* Header */
        .header {
            background: var(--aws-navy);
            padding: 0 24px;
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
            text-decoration: none;
            font-weight: 600;
            font-size: 15px;
        }

        .logo-icon {
            width: 28px;
            height: 28px;
            background: var(--aws-orange);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .nav-links {
            display: flex;
            gap: 4px;
        }

        .nav-links a {
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            padding: 8px 14px;
            border-radius: var(--radius-sm);
            font-size: 13px;
            font-weight: 500;
            transition: all 0.15s;
        }

        .nav-links a:hover {
            background: rgba(255,255,255,0.1);
            color: white;
        }

        .nav-links a.active {
            background: rgba(255,255,255,0.15);
            color: white;
        }

        /* Main Layout */
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
        }

        /* Page Header */
        .page-header {
            margin-bottom: 24px;
        }

        .page-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .page-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            max-width: 700px;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: var(--bg-white);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
            padding: 16px 20px;
            box-shadow: var(--shadow-sm);
        }

        .stat-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
            font-family: var(--font-mono);
        }

        .stat-value.success { color: var(--success-green); }
        .stat-value.danger { color: var(--danger-red); }

        /* Main Grid */
        .simulator-grid {
            display: grid;
            grid-template-columns: 300px 1fr 340px;
            gap: 20px;
        }

        /* Panel Styles */
        .panel {
            background: var(--bg-white);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
        }

        .panel-header {
            padding: 14px 18px;
            border-bottom: 1px solid var(--border-light);
            background: var(--bg-primary);
        }

        .panel-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .panel-title .icon {
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .panel-body {
            padding: 16px;
        }

        /* Attack Scenarios Panel */
        .scenarios-panel {
            position: sticky;
            top: 80px;
            height: fit-content;
        }

        .attack-btn {
            width: 100%;
            background: var(--bg-white);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
            padding: 12px 14px;
            margin-bottom: 8px;
            cursor: pointer;
            text-align: left;
            transition: all 0.15s;
            position: relative;
        }

        .attack-btn:hover:not(:disabled) {
            border-color: var(--aws-orange);
            box-shadow: var(--shadow-sm);
        }

        .attack-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .attack-btn.active {
            border-color: var(--aws-orange);
            background: #fff8f0;
        }

        .attack-btn::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: var(--danger-red);
            border-radius: 3px 0 0 3px;
        }

        .attack-name {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .attack-desc {
            font-size: 11px;
            color: var(--text-muted);
        }

        .threat-level {
            font-size: 9px;
            font-weight: 700;
            padding: 2px 6px;
            border-radius: 3px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .threat-high { background: var(--danger-bg); color: var(--danger-red); }
        .threat-medium { background: var(--warning-bg); color: var(--warning-orange); }
        .threat-critical { background: #4a1942; color: #ff6b9d; }

        /* Visualization Panel */
        .viz-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* Architecture Diagram */
        .architecture-container {
            background: var(--bg-white);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: 24px;
            position: relative;
            min-height: 280px;
        }

        .arch-label {
            position: absolute;
            top: 12px;
            left: 16px;
            font-size: 10px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .architecture-diagram {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 30px 10px 10px;
            position: relative;
        }

        /* Connection Lines */
        .connections-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .connection {
            stroke: var(--border-medium);
            stroke-width: 2;
            stroke-dasharray: 6, 4;
            fill: none;
            transition: all 0.3s;
        }

        .connection.active {
            stroke: var(--success-green);
            stroke-dasharray: none;
        }

        .connection.attack {
            stroke: var(--danger-red);
            stroke-dasharray: 8, 4;
            animation: flowAttack 0.5s linear infinite;
        }

        @keyframes flowAttack {
            to { stroke-dashoffset: -12; }
        }

        /* Network Nodes */
        .node {
            background: var(--bg-white);
            border: 2px solid var(--border-medium);
            border-radius: var(--radius-md);
            padding: 14px 16px;
            text-align: center;
            min-width: 110px;
            position: relative;
            z-index: 10;
            transition: all 0.3s;
        }

        .node-icon {
            width: 40px;
            height: 40px;
            margin: 0 auto 8px;
            background: var(--bg-primary);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .node-name {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .node-detail {
            font-size: 10px;
            color: var(--text-muted);
            font-family: var(--font-mono);
        }

        .node.highlight {
            border-color: var(--warning-orange);
            background: #fffbf5;
            animation: pulse 1s ease infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .node.blocked {
            border-color: var(--success-green);
            background: #f0fdf8;
        }

        .node.attacked {
            border-color: var(--danger-red);
            animation: shake 0.4s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-4px); }
            75% { transform: translateX(4px); }
        }

        /* Attacker Icon */
        .attacker {
            position: absolute;
            left: -50px;
            top: 50%;
            transform: translateY(-50%);
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, var(--danger-red), #ff6b6b);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            opacity: 0;
            z-index: 20;
            box-shadow: 0 4px 12px rgba(209, 50, 18, 0.3);
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .attacker.active {
            opacity: 1;
            left: 10px;
        }

        /* Shield Effect */
        .shield {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            border: 3px solid var(--success-green);
            border-radius: 50%;
            opacity: 0;
            pointer-events: none;
            z-index: 25;
        }

        .shield.active {
            animation: shieldPulse 0.6s ease-out forwards;
        }

        @keyframes shieldPulse {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1.8); }
        }

        /* Blocked Banner */
        .blocked-banner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: var(--success-green);
            color: white;
            font-size: 14px;
            font-weight: 700;
            padding: 12px 24px;
            border-radius: var(--radius-md);
            opacity: 0;
            z-index: 30;
            white-space: nowrap;
            box-shadow: var(--shadow-lg);
        }

        .blocked-banner.show {
            animation: bannerPop 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes bannerPop {
            to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }

        /* Defense Layers */
        .defense-layers {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border-light);
        }

        .defense-layer {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            background: var(--bg-primary);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-sm);
            font-size: 11px;
            font-weight: 500;
            color: var(--text-muted);
            transition: all 0.2s;
        }

        .defense-layer .dot {
            width: 6px;
            height: 6px;
            background: var(--border-medium);
            border-radius: 50%;
        }

        .defense-layer.active {
            background: #f0fdf8;
            border-color: var(--success-green);
            color: var(--success-green);
        }

        .defense-layer.active .dot {
            background: var(--success-green);
            box-shadow: 0 0 6px var(--success-green);
        }

        /* Event Log */
        .log-container {
            max-height: 200px;
            overflow-y: auto;
        }

        .log-entry {
            display: flex;
            gap: 10px;
            padding: 8px 12px;
            margin-bottom: 4px;
            border-radius: var(--radius-sm);
            font-size: 12px;
            font-family: var(--font-mono);
            opacity: 0;
            transform: translateY(-5px);
            animation: logAppear 0.2s ease forwards;
        }

        @keyframes logAppear {
            to { opacity: 1; transform: translateY(0); }
        }

        .log-entry.info { background: var(--info-bg); color: var(--info-blue); }
        .log-entry.warning { background: var(--warning-bg); color: var(--warning-orange); }
        .log-entry.success { background: var(--success-bg); color: var(--success-green); }
        .log-entry.error { background: var(--danger-bg); color: var(--danger-red); }

        .log-time {
            color: inherit;
            opacity: 0.7;
            flex-shrink: 0;
        }

        /* Explanation Panel (Right Side) */
        .explanation-panel {
            position: sticky;
            top: 80px;
            height: fit-content;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        /* What's Happening Card */
        .whats-happening {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: var(--radius-lg);
            padding: 20px;
            color: white;
        }

        .wh-title {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.9;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .wh-content {
            font-size: 14px;
            line-height: 1.6;
        }

        .wh-content strong {
            color: #ffd700;
        }

        /* Real World Analogy */
        .analogy-card {
            background: var(--bg-white);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            overflow: hidden;
        }

        .analogy-header {
            background: #fef3c7;
            padding: 12px 16px;
            border-bottom: 1px solid #fde68a;
        }

        .analogy-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--warning-orange);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .analogy-body {
            padding: 16px;
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .analogy-body .emoji-icon {
            font-size: 24px;
            margin-right: 8px;
            vertical-align: middle;
        }

        /* Technical Details Tabs */
        .tech-tabs {
            background: var(--bg-white);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            overflow: hidden;
        }

        .tabs-nav {
            display: flex;
            border-bottom: 1px solid var(--border-light);
            background: var(--bg-primary);
        }

        .tab-btn {
            flex: 1;
            padding: 10px 12px;
            background: none;
            border: none;
            font-family: var(--font-sans);
            font-size: 12px;
            font-weight: 500;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.15s;
            position: relative;
        }

        .tab-btn:hover {
            color: var(--text-secondary);
            background: rgba(0,0,0,0.02);
        }

        .tab-btn.active {
            color: var(--aws-orange);
        }

        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--aws-orange);
        }

        .tab-content {
            display: none;
            padding: 16px;
            max-height: 300px;
            overflow-y: auto;
        }

        .tab-content.active {
            display: block;
        }

        /* Code Block */
        .code-block {
            background: #1e1e2e;
            border-radius: var(--radius-md);
            padding: 14px;
            overflow-x: auto;
            font-family: var(--font-mono);
            font-size: 11px;
            line-height: 1.5;
            color: #cdd6f4;
        }

        .code-block .comment { color: #6c7086; }
        .code-block .keyword { color: #cba6f7; }
        .code-block .string { color: #a6e3a1; }
        .code-block .function { color: #89b4fa; }

        /* GuardDuty Finding */
        .finding-card {
            border: 1px solid var(--danger-red);
            border-radius: var(--radius-md);
            overflow: hidden;
        }

        .finding-header {
            background: var(--danger-bg);
            padding: 12px 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .finding-type {
            font-family: var(--font-mono);
            font-size: 11px;
            font-weight: 600;
            color: var(--danger-red);
        }

        .finding-severity {
            font-size: 9px;
            font-weight: 700;
            padding: 3px 8px;
            background: var(--danger-red);
            color: white;
            border-radius: 3px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .finding-body {
            padding: 14px;
        }

        .finding-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 6px;
        }

        .finding-desc {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        .finding-json {
            background: #1e1e2e;
            border-radius: var(--radius-sm);
            padding: 10px;
            font-family: var(--font-mono);
            font-size: 10px;
            color: #6c7086;
            max-height: 120px;
            overflow: auto;
        }

        /* Runbook */
        .runbook {
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .runbook h4 {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
            margin: 14px 0 8px 0;
        }

        .runbook h4:first-child { margin-top: 0; }

        .runbook pre {
            background: #1e1e2e;
            border-radius: var(--radius-sm);
            padding: 10px;
            overflow-x: auto;
            font-family: var(--font-mono);
            font-size: 10px;
            color: #cdd6f4;
            margin: 8px 0;
        }

        .runbook ul {
            margin-left: 16px;
        }

        .runbook li {
            margin: 4px 0;
        }

        /* Placeholder */
        .placeholder {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-muted);
        }

        .placeholder-icon {
            font-size: 32px;
            margin-bottom: 12px;
            opacity: 0.5;
        }

        .placeholder-text {
            font-size: 13px;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .simulator-grid {
                grid-template-columns: 1fr;
            }

            .scenarios-panel,
            .explanation-panel {
                position: static;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                height: auto;
                padding: 12px;
                gap: 12px;
            }

            .nav-links {
                flex-wrap: wrap;
                justify-content: center;
            }

            .architecture-diagram {
                flex-wrap: wrap;
                gap: 16px;
                justify-content: center;
            }

            .node {
                min-width: 90px;
            }
        }
    </style>
</head>
<body>

<header class="header">
    <a href="index.html" class="logo">
        <div class="logo-icon">‚òÅ</div>
        AWS Student Data Infrastructure
    </a>
    <nav class="nav-links">
        <a href="index.html">Home</a>
        <a href="architecture.html">Architecture</a>
        <a href="automation.html">IAM Automation</a>
        <a href="interactive-diagram.html">Diagram</a>
        <a href="security-simulator.html" class="active">Security</a>
    </nav>
</header>

<main class="main-container">
    <header class="page-header">
        <h1 class="page-title">Security Attack Simulator</h1>
        <p class="page-subtitle">
            Watch real-time simulations of cyber attacks against our AWS infrastructure. 
            See how multiple layers of security work together to protect sensitive student data.
        </p>
    </header>

    <!-- Stats -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-label">Attacks Blocked</div>
            <div class="stat-value success" id="attacksBlocked">0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Security Alerts</div>
            <div class="stat-value" id="alertsGenerated">0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Detection Rate</div>
            <div class="stat-value success">100%</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Data Breaches</div>
            <div class="stat-value danger">0</div>
        </div>
    </div>

    <div class="simulator-grid">
        <!-- Left: Attack Scenarios -->
        <aside class="scenarios-panel panel">
            <div class="panel-header">
                <div class="panel-title">
                    <span class="icon">‚ö†Ô∏è</span>
                    Attack Scenarios
                </div>
            </div>
            <div class="panel-body">
                <button class="attack-btn" data-attack="direct-db">
                    <div class="attack-name">
                        Direct Database Access
                        <span class="threat-level threat-high">High</span>
                    </div>
                    <div class="attack-desc">Hacker tries to connect directly to database</div>
                </button>

                <button class="attack-btn" data-attack="privilege-escalation">
                    <div class="attack-name">
                        Privilege Escalation
                        <span class="threat-level threat-medium">Medium</span>
                    </div>
                    <div class="attack-desc">User tries to gain admin access</div>
                </button>

                <button class="attack-btn" data-attack="s3-public">
                    <div class="attack-name">
                        Data Exposure Attempt
                        <span class="threat-level threat-critical">Critical</span>
                    </div>
                    <div class="attack-desc">Making private files public</div>
                </button>

                <button class="attack-btn" data-attack="credential-theft">
                    <div class="attack-name">
                        Stolen Credentials
                        <span class="threat-level threat-high">High</span>
                    </div>
                    <div class="attack-desc">Using stolen login from unusual location</div>
                </button>

                <button class="attack-btn" data-attack="port-scan">
                    <div class="attack-name">
                        Network Reconnaissance
                        <span class="threat-level threat-medium">Medium</span>
                    </div>
                    <div class="attack-desc">Scanning for vulnerabilities</div>
                </button>

                <button class="attack-btn" data-attack="data-theft">
                    <div class="attack-name">
                        Mass Data Download
                        <span class="threat-level threat-high">High</span>
                    </div>
                    <div class="attack-desc">Attempting to steal large amounts of data</div>
                </button>
            </div>
        </aside>

        <!-- Center: Visualization -->
        <div class="viz-panel">
            <!-- Architecture Diagram -->
            <div class="architecture-container">
                <div class="arch-label">Network Architecture</div>
                
                <svg class="connections-svg" viewBox="0 0 600 200" preserveAspectRatio="xMidYMid meet">
                    <path id="conn1" class="connection" d="M100,100 L200,100" />
                    <path id="conn2" class="connection" d="M280,100 L380,100" />
                    <path id="conn3" class="connection" d="M460,100 L560,100" />
                </svg>

                <div class="architecture-diagram">
                    <div class="attacker" id="attacker">ü•∑</div>

                    <div class="node" id="node-internet">
                        <div class="node-icon">üåê</div>
                        <div class="node-name">Internet</div>
                        <div class="node-detail">Public</div>
                    </div>

                    <div class="node" id="node-gateway">
                        <div class="node-icon">üöß</div>
                        <div class="node-name">Gateway</div>
                        <div class="node-detail">WAF + ALB</div>
                    </div>

                    <div class="node" id="node-app">
                        <div class="node-icon">‚öôÔ∏è</div>
                        <div class="node-name">Application</div>
                        <div class="node-detail">Private</div>
                    </div>

                    <div class="node" id="node-db">
                        <div class="node-icon">üóÑÔ∏è</div>
                        <div class="node-name">Database</div>
                        <div class="node-detail">Isolated</div>
                    </div>

                    <div class="shield" id="shield"></div>
                    <div class="blocked-banner" id="blockedBanner">‚úì Attack Blocked</div>
                </div>

                <div class="defense-layers">
                    <div class="defense-layer" id="layer-sg"><span class="dot"></span> Security Groups</div>
                    <div class="defense-layer" id="layer-nacl"><span class="dot"></span> Network ACLs</div>
                    <div class="defense-layer" id="layer-iam"><span class="dot"></span> IAM Policies</div>
                    <div class="defense-layer" id="layer-encryption"><span class="dot"></span> Encryption</div>
                    <div class="defense-layer" id="layer-monitoring"><span class="dot"></span> GuardDuty</div>
                </div>
            </div>

            <!-- Event Log -->
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">
                        <span class="icon">üìã</span>
                        Security Event Log
                    </div>
                </div>
                <div class="panel-body">
                    <div class="log-container" id="logContainer">
                        <div class="log-entry info" style="animation: none; opacity: 1;">
                            <span class="log-time">[--:--:--]</span>
                            <span>Security monitoring active. Select an attack scenario to begin.</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Technical Tabs -->
            <div class="tech-tabs">
                <div class="tabs-nav">
                    <button class="tab-btn active" data-tab="code">Attack Code</button>
                    <button class="tab-btn" data-tab="finding">Security Alert</button>
                    <button class="tab-btn" data-tab="response">Response Steps</button>
                </div>
                <div class="tab-content active" id="tab-code">
                    <div class="placeholder" id="codePlaceholder">
                        <div class="placeholder-icon">üíª</div>
                        <div class="placeholder-text">Select an attack to see the code hackers would use</div>
                    </div>
                    <div class="code-block" id="codeDisplay" style="display: none;"></div>
                </div>
                <div class="tab-content" id="tab-finding">
                    <div class="placeholder" id="findingPlaceholder">
                        <div class="placeholder-icon">üîç</div>
                        <div class="placeholder-text">Security alerts will appear here</div>
                    </div>
                    <div id="findingDisplay" style="display: none;"></div>
                </div>
                <div class="tab-content" id="tab-response">
                    <div class="placeholder" id="responsePlaceholder">
                        <div class="placeholder-icon">üõ†Ô∏è</div>
                        <div class="placeholder-text">Incident response procedures will appear here</div>
                    </div>
                    <div class="runbook" id="responseDisplay" style="display: none;"></div>
                </div>
            </div>
        </div>

        <!-- Right: Explanation Panel -->
        <aside class="explanation-panel">
            <!-- What's Happening -->
            <div class="whats-happening" id="whatsHappening">
                <div class="wh-title">
                    <span>üí°</span> What's Happening
                </div>
                <div class="wh-content" id="whContent">
                    <strong>Welcome!</strong> This simulator shows how our AWS security protects student data. 
                    Click any attack on the left to see how multiple security layers work together to stop hackers.
                </div>
            </div>

            <!-- Real World Analogy -->
            <div class="analogy-card" id="analogyCard">
                <div class="analogy-header">
                    <div class="analogy-title">
                        <span>üè†</span> Think of it like...
                    </div>
                </div>
                <div class="analogy-body" id="analogyContent">
                    <span class="emoji-icon">üè¢</span>
                    Imagine a high-security office building. There's a reception desk (gateway), 
                    locked doors between floors (network rules), ID badge scanners (authentication), 
                    and security cameras (monitoring). Our AWS setup works the same way!
                </div>
            </div>

            <!-- Why It Matters -->
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">
                        <span class="icon">üéì</span>
                        Why This Matters
                    </div>
                </div>
                <div class="panel-body" id="whyMatters" style="font-size: 13px; color: var(--text-secondary); line-height: 1.6;">
                    Student data includes sensitive information like grades, addresses, and financial aid records. 
                    A data breach could lead to identity theft, privacy violations, and legal consequences. 
                    <br><br>
                    Our security ensures <strong>FERPA compliance</strong> and protects over 8,000 students.
                </div>
            </div>
        </aside>
    </div>
</main>

<script>
// ============================================
// STATE
// ============================================
let isSimulating = false;
let attackCount = 0;
let alertCount = 0;

// ============================================
// ATTACK DATA
// ============================================
const attacks = {
    "direct-db": {
        title: "Direct Database Access",
        targetNodes: ["node-internet", "node-db"],
        defenseLayers: ["layer-sg", "layer-nacl"],
        
        // Plain English explanation
        whatsHappening: `A hacker is trying to <strong>connect directly to our database</strong> from the internet ‚Äî like trying to walk straight into a bank vault from the street.
        <br><br>
        Our security stops this because the database is in a <strong>private network</strong> with no public address. It's literally unreachable from outside.`,
        
        analogy: `<span class="emoji-icon">üè¶</span>
        Imagine a bank vault that's <strong>underground with no entrance from the street</strong>. 
        You can only reach it through the bank lobby, then past the tellers, then through a secured door. 
        The hacker is trying to dig a tunnel directly to the vault ‚Äî but there's no path there.`,
        
        whyMatters: `If hackers could connect directly to databases, they could <strong>steal all student records instantly</strong> ‚Äî names, grades, social security numbers, everything. 
        Our network isolation makes this physically impossible.`,

        code: `<span class="comment"># Hacker's attempt to connect directly to database</span>
<span class="keyword">import</span> psycopg2

<span class="comment"># This connection will FAIL because:</span>
<span class="comment"># 1. Database has no public IP address</span>
<span class="comment"># 2. Security Groups only allow app servers</span>
<span class="comment"># 3. No route exists from internet to DB subnet</span>

conn = psycopg2.connect(
    host=<span class="string">"student-db.aws-region.rds.amazonaws.com"</span>,
    port=<span class="string">5432</span>,
    user=<span class="string">"hacker"</span>,
    password=<span class="string">"stolen_password"</span>
)
<span class="comment"># Result: Connection timeout - no network path exists</span>`,

        finding: {
            type: "UnauthorizedAccess:EC2/MaliciousIPCaller",
            severity: "HIGH",
            title: "Blocked connection attempt from suspicious IP",
            description: "Someone tried to connect to a protected resource from an IP address that shouldn't have access.",
            details: { "SourceIP": "203.0.113.45", "TargetPort": 5432, "Action": "BLOCKED", "Reason": "No network route exists" }
        },

        response: `<h4>1. What Our System Did Automatically</h4>
<ul>
<li>Blocked the connection (no network path exists)</li>
<li>Logged the attempt in VPC Flow Logs</li>
<li>Generated a security alert</li>
</ul>

<h4>2. What a Security Team Would Check</h4>
<pre># View blocked connection attempts
aws logs filter-log-events \\
  --log-group-name /aws/vpc/flowlogs \\
  --filter-pattern "REJECT"</pre>

<h4>3. No Action Needed</h4>
<p>The architecture itself prevents this attack. There's nothing to "fix" ‚Äî the security worked exactly as designed.</p>`,

        steps: [
            { type: "info", msg: "Incoming connection from external IP: 203.0.113.45" },
            { type: "warning", msg: "Target: Database server on port 5432" },
            { type: "info", msg: "Checking network routes..." },
            { type: "success", msg: "‚úì Database subnet has no internet gateway" },
            { type: "success", msg: "‚úì Database has no public IP address" },
            { type: "info", msg: "Checking Security Group rules..." },
            { type: "success", msg: "‚úì Only application servers can connect to database" },
            { type: "error", msg: "‚ùå CONNECTION BLOCKED ‚Äî No path to database exists" }
        ]
    },

    "privilege-escalation": {
        title: "Privilege Escalation",
        targetNodes: ["node-app"],
        defenseLayers: ["layer-iam", "layer-monitoring"],
        
        whatsHappening: `A user with <strong>limited access</strong> (like a student worker) is trying to <strong>give themselves admin powers</strong>.
        <br><br>
        This is like a cashier trying to promote themselves to bank manager. Our permission system says "nice try, but no."`,
        
        analogy: `<span class="emoji-icon">üîë</span>
        Imagine an employee with a <strong>key to the supply closet</strong> trying to make a copy of the <strong>master key</strong> that opens every door. 
        The key-making machine checks their badge and says "You're not authorized to copy master keys" ‚Äî and logs the suspicious request.`,
        
        whyMatters: `If users could grant themselves admin access, a disgruntled employee could <strong>delete all records</strong>, 
        <strong>steal sensitive data</strong>, or <strong>lock everyone else out</strong>. IAM policies prevent this.`,

        code: `<span class="comment"># User tries to give themselves admin access</span>
<span class="keyword">import</span> boto3

iam = boto3.client(<span class="string">'iam'</span>)

<span class="comment"># Attempting to attach the most powerful policy</span>
<span class="keyword">try</span>:
    iam.attach_user_policy(
        UserName=<span class="string">'student_worker'</span>,
        PolicyArn=<span class="string">'arn:aws:iam::aws:policy/AdministratorAccess'</span>
    )
<span class="keyword">except</span> Exception <span class="keyword">as</span> e:
    print(<span class="string">"Access Denied: You cannot modify permissions"</span>)
    
<span class="comment"># AWS logs this failed attempt in CloudTrail</span>`,

        finding: {
            type: "PrivilegeEscalation:IAMUser/AnomalousBehavior",
            severity: "MEDIUM",
            title: "User attempted to escalate their own privileges",
            description: "A user tried to attach admin permissions to their account. This was blocked by IAM policies.",
            details: { "User": "student_worker", "AttemptedAction": "AttachUserPolicy", "TargetPolicy": "AdministratorAccess", "Result": "AccessDenied" }
        },

        response: `<h4>1. Immediate Response</h4>
<pre># Temporarily restrict the suspicious user
aws iam put-user-policy --user-name student_worker \\
  --policy-name TempRestriction \\
  --policy-document '{"Version":"2012-10-17","Statement":[{"Effect":"Deny","Action":"iam:*","Resource":"*"}]}'</pre>

<h4>2. Investigate</h4>
<ul>
<li>Was this a mistake or intentional?</li>
<li>Has this user made other suspicious requests?</li>
<li>Check CloudTrail for recent activity</li>
</ul>

<h4>3. Follow Up</h4>
<p>Contact the user's supervisor. If intentional, escalate to security team.</p>`,

        steps: [
            { type: "info", msg: "API call detected: iam:AttachUserPolicy" },
            { type: "warning", msg: "User 'student_worker' requesting admin access" },
            { type: "info", msg: "Checking user's permissions..." },
            { type: "success", msg: "‚úì User lacks permission to modify IAM policies" },
            { type: "info", msg: "Logging attempt to CloudTrail..." },
            { type: "info", msg: "GuardDuty analyzing behavior pattern..." },
            { type: "error", msg: "‚ùå ACCESS DENIED ‚Äî Cannot escalate privileges" }
        ]
    },

    "s3-public": {
        title: "Data Exposure Attempt",
        targetNodes: ["node-app"],
        defenseLayers: ["layer-encryption", "layer-monitoring"],
        
        whatsHappening: `Someone is trying to make our <strong>private student files publicly accessible</strong> on the internet ‚Äî like posting confidential records on a public bulletin board.
        <br><br>
        AWS has a safety switch called <strong>"Block Public Access"</strong> that prevents this, even if someone tries really hard.`,
        
        analogy: `<span class="emoji-icon">üìÅ</span>
        Imagine a filing cabinet with a <strong>special lock that prevents the drawer from being left open</strong>. 
        Even if someone tries to prop it open, the lock automatically closes it. 
        Our S3 buckets have this "auto-close" feature built in.`,
        
        whyMatters: `Exposed student data could lead to <strong>identity theft</strong>, <strong>FERPA violations</strong>, 
        and <strong>lawsuits</strong>. Block Public Access is a safety net that catches mistakes and malicious actions.`,

        code: `<span class="comment"># Attempting to make student files public</span>
<span class="keyword">import</span> boto3

s3 = boto3.client(<span class="string">'s3'</span>)

<span class="comment"># Try to make bucket publicly readable</span>
<span class="keyword">try</span>:
    s3.put_bucket_acl(
        Bucket=<span class="string">'student-records-bucket'</span>,
        ACL=<span class="string">'public-read'</span>  <span class="comment"># This would expose all files!</span>
    )
<span class="keyword">except</span> Exception <span class="keyword">as</span> e:
    print(<span class="string">"Blocked by S3 Block Public Access"</span>)

<span class="comment"># The setting physically prevents public access</span>`,

        finding: {
            type: "Policy:S3/BucketPublicAccessGranted",
            severity: "CRITICAL",
            title: "Attempt to make private data public was blocked",
            description: "Someone tried to change bucket permissions to allow public access. S3 Block Public Access prevented this.",
            details: { "Bucket": "student-records-bucket", "AttemptedACL": "public-read", "BlockedBy": "S3 Block Public Access", "AccountLevel": true }
        },

        response: `<h4>1. Verify Protection is Active</h4>
<pre># Check that Block Public Access is enabled
aws s3api get-public-access-block \\
  --bucket student-records-bucket</pre>

<h4>2. Identify Who Tried This</h4>
<pre># Check CloudTrail for the attempt
aws cloudtrail lookup-events \\
  --lookup-attributes AttributeKey=EventName,AttributeValue=PutBucketAcl</pre>

<h4>3. Review Access</h4>
<p>Determine if this user should have bucket permissions at all. Consider restricting access.</p>`,

        steps: [
            { type: "info", msg: "API call: s3:PutBucketAcl" },
            { type: "warning", msg: "Requested permission: public-read" },
            { type: "info", msg: "Checking S3 Block Public Access..." },
            { type: "success", msg: "‚úì BlockPublicAcls: ENABLED" },
            { type: "success", msg: "‚úì BlockPublicPolicy: ENABLED" },
            { type: "info", msg: "Logging blocked attempt..." },
            { type: "error", msg: "‚ùå BLOCKED ‚Äî Public access is not allowed" }
        ]
    },

    "credential-theft": {
        title: "Stolen Credentials",
        targetNodes: ["node-internet", "node-gateway", "node-app"],
        defenseLayers: ["layer-monitoring"],
        
        whatsHappening: `Someone <strong>stole login credentials</strong> (maybe through phishing) and is now using them from a <strong>different country</strong>.
        <br><br>
        Our monitoring system notices: "Wait, this user normally logs in from New York, but now they're suddenly in Russia?" üö®`,
        
        analogy: `<span class="emoji-icon">üí≥</span>
        It's like your credit card company calling to ask: "Did you just buy something in Nigeria? You were in Texas an hour ago." 
        They detect <strong>impossible travel</strong> ‚Äî and so does our system.`,
        
        whyMatters: `Stolen credentials are the #1 way hackers get into systems. 
        Even with a valid password, <strong>behavioral detection</strong> catches when something doesn't add up.`,

        code: `<span class="comment"># Hacker using stolen credentials from unusual location</span>
<span class="keyword">import</span> boto3

<span class="comment"># These are real credentials stolen via phishing</span>
<span class="comment"># The hacker is in Dublin, but the real user is in NYC</span>

session = boto3.Session(
    aws_access_key_id=<span class="string">'AKIA_STOLEN_KEY'</span>,
    aws_secret_access_key=<span class="string">'stolen_secret'</span>,
    region_name=<span class="string">'eu-west-1'</span>  <span class="comment"># Different region!</span>
)

ec2 = session.client(<span class="string">'ec2'</span>)

<span class="comment"># Rapid API calls trigger anomaly detection</span>
<span class="keyword">for</span> i <span class="keyword">in</span> range(50):
    ec2.describe_instances()
    
<span class="comment"># GuardDuty: "This user never uses eu-west-1..."</span>`,

        finding: {
            type: "UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration",
            severity: "HIGH",
            title: "Credentials used from unusual location",
            description: "Login credentials are being used from an IP address in a different geographic location than normal. Possible credential theft.",
            details: { "NormalLocation": "New York, USA", "CurrentLocation": "Dublin, Ireland", "UnusualAPICount": 50, "TimeWindow": "2 minutes" }
        },

        response: `<h4>1. Disable Credentials Immediately</h4>
<pre># Disable the compromised access key
aws iam update-access-key \\
  --access-key-id AKIA_STOLEN_KEY \\
  --status Inactive</pre>

<h4>2. Check What They Did</h4>
<pre># Review all actions taken with these credentials
aws cloudtrail lookup-events \\
  --lookup-attributes AttributeKey=AccessKeyId,AttributeValue=AKIA_STOLEN_KEY</pre>

<h4>3. Contact the Real User</h4>
<ul>
<li>Confirm they didn't travel to Dublin</li>
<li>Have them change their password</li>
<li>Enable MFA if not already active</li>
</ul>`,

        steps: [
            { type: "warning", msg: "Login from unusual location: Dublin, Ireland" },
            { type: "info", msg: "User baseline: New York, USA" },
            { type: "warning", msg: "50 API calls in 2 minutes (abnormal)" },
            { type: "info", msg: "GuardDuty analyzing patterns..." },
            { type: "success", msg: "‚úì Anomaly detected: Impossible travel" },
            { type: "error", msg: "‚ö†Ô∏è HIGH SEVERITY ALERT generated" },
            { type: "success", msg: "‚úì Automated response: Credentials disabled" }
        ]
    },

    "port-scan": {
        title: "Network Reconnaissance",
        targetNodes: ["node-app", "node-db"],
        defenseLayers: ["layer-sg", "layer-nacl", "layer-monitoring"],
        
        whatsHappening: `A hacker is <strong>scanning our network</strong> to find open doors ‚Äî checking thousands of ports to see what services are running.
        <br><br>
        This is like a burglar walking down a street, <strong>trying every door handle</strong> to see which ones are unlocked.`,
        
        analogy: `<span class="emoji-icon">üö™</span>
        Imagine someone walking down your street, <strong>jiggling every door handle</strong> on every house. 
        Even if all doors are locked, it's suspicious behavior! Our system notices this "jiggling" and alerts us.`,
        
        whyMatters: `Port scanning is often the <strong>first step before an attack</strong>. 
        By detecting it early, we know someone is probing our defenses and can watch them closely.`,

        code: `<span class="comment"># Hacker scanning for open ports</span>
<span class="keyword">import</span> socket
<span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor

target = <span class="string">"172.32.20.0/24"</span>  <span class="comment"># Database subnet</span>
ports = [22, 80, 443, 3306, 5432, 27017]

<span class="keyword">def</span> <span class="function">scan_port</span>(ip, port):
    sock = socket.socket()
    sock.settimeout(0.1)
    result = sock.connect_ex((ip, port))
    <span class="keyword">if</span> result == 0:
        print(<span class="string">f"Port {port} open on {ip}"</span>)
    sock.close()

<span class="comment"># Rapid scanning creates thousands of REJECT log entries</span>
<span class="comment"># GuardDuty correlates this as reconnaissance</span>`,

        finding: {
            type: "Recon:EC2/PortScan",
            severity: "MEDIUM",
            title: "Port scanning activity detected",
            description: "An instance is probing multiple ports on other hosts. This is typically reconnaissance before an attack.",
            details: { "SourceIP": "172.32.10.55", "TargetSubnet": "172.32.20.0/24", "PortsScanned": 6, "ConnectionAttempts": 2048 }
        },

        response: `<h4>1. Identify the Scanner</h4>
<pre># Find the instance doing the scanning
aws ec2 describe-instances \\
  --filters "Name=private-ip-address,Values=172.32.10.55"</pre>

<h4>2. Isolate if Compromised</h4>
<pre># Move to isolation security group
aws ec2 modify-instance-attribute \\
  --instance-id i-xxxxx \\
  --groups sg-isolation</pre>

<h4>3. Investigate</h4>
<ul>
<li>Is this a legitimate security scan?</li>
<li>Was the instance compromised?</li>
<li>Check for malware or unauthorized software</li>
</ul>`,

        steps: [
            { type: "warning", msg: "Unusual network activity from 172.32.10.55" },
            { type: "info", msg: "Scanning database subnet: 172.32.20.0/24" },
            { type: "info", msg: "Ports checked: 22, 80, 443, 3306, 5432..." },
            { type: "success", msg: "‚úì All connection attempts REJECTED" },
            { type: "success", msg: "‚úì VPC Flow Logs capturing activity" },
            { type: "info", msg: "GuardDuty correlating network patterns..." },
            { type: "error", msg: "‚ö†Ô∏è ALERT: Reconnaissance detected" }
        ]
    },

    "data-theft": {
        title: "Mass Data Download",
        targetNodes: ["node-app"],
        defenseLayers: ["layer-iam", "layer-monitoring"],
        
        whatsHappening: `Someone is <strong>downloading huge amounts of student data</strong> very quickly ‚Äî way more than normal usage would require.
        <br><br>
        Our monitoring notices: "This user usually downloads 5 files a day. Why are they suddenly grabbing 500 files in 10 minutes?"`,
        
        analogy: `<span class="emoji-icon">üìö</span>
        Imagine a library where you normally check out 2-3 books. Suddenly you're loading <strong>a shopping cart with 500 books</strong>. 
        The librarian would definitely ask questions! Our system does the same thing.`,
        
        whyMatters: `Data exfiltration is how breaches happen. 
        Even if someone has legitimate access, <strong>unusual download patterns</strong> could mean they're stealing data to sell or leak.`,

        code: `<span class="comment"># Attempting to download massive amounts of data</span>
<span class="keyword">import</span> boto3

s3 = boto3.client(<span class="string">'s3'</span>)

<span class="comment"># List all sensitive files</span>
objects = s3.list_objects_v2(
    Bucket=<span class="string">'student-records'</span>,
    Prefix=<span class="string">'transcripts/'</span>
)

<span class="comment"># Download everything rapidly</span>
<span class="keyword">for</span> obj <span class="keyword">in</span> objects[<span class="string">'Contents'</span>]:
    s3.download_file(
        <span class="string">'student-records'</span>,
        obj[<span class="string">'Key'</span>],
        <span class="string">f"/tmp/{obj['Key']}"</span>
    )

<span class="comment"># This unusual volume triggers alerts</span>`,

        finding: {
            type: "Exfiltration:S3/ObjectRead.Unusual",
            severity: "HIGH",
            title: "Unusual data download pattern detected",
            description: "A user is downloading far more data than their normal baseline. This matches data exfiltration patterns.",
            details: { "FilesDownloaded": 127, "DataVolume": "52.4 MB", "TimeWindow": "15 minutes", "NormalBaseline": "5 files/day" }
        },

        response: `<h4>1. Restrict Access Immediately</h4>
<pre># Block the user's access to the bucket
aws s3api put-bucket-policy --bucket student-records \\
  --policy '{"Statement":[{"Effect":"Deny","Principal":{"AWS":"arn:aws:iam::xxx:user/suspect"},"Action":"s3:*","Resource":"*"}]}'</pre>

<h4>2. Assess Exposure</h4>
<ul>
<li>What files were downloaded?</li>
<li>Do they contain PII?</li>
<li>Is this a reportable breach?</li>
</ul>

<h4>3. Contact User</h4>
<p>There may be a legitimate reason (end of semester reports). But verify before restoring access.</p>`,

        steps: [
            { type: "warning", msg: "Unusual download volume: 127 files in 15 minutes" },
            { type: "info", msg: "User baseline: 5 files per day" },
            { type: "info", msg: "Data volume: 52.4 MB" },
            { type: "info", msg: "S3 access logs recording all activity..." },
            { type: "info", msg: "GuardDuty analyzing data transfer patterns..." },
            { type: "error", msg: "‚ö†Ô∏è ALERT: Possible data exfiltration" },
            { type: "success", msg: "‚úì Automated alert sent to security team" }
        ]
    }
};

// ============================================
// DOM ELEMENTS
// ============================================
const attackBtns = document.querySelectorAll('.attack-btn');
const tabBtns = document.querySelectorAll('.tab-btn');
const logContainer = document.getElementById('logContainer');
const attacker = document.getElementById('attacker');
const shield = document.getElementById('shield');
const blockedBanner = document.getElementById('blockedBanner');

// ============================================
// HELPER FUNCTIONS
// ============================================
function sleep(ms) {
    return new Promise(r => setTimeout(r, ms));
}

function timestamp() {
    return new Date().toLocaleTimeString('en-US', { hour12: false });
}

function log(type, msg) {
    const entry = document.createElement('div');
    entry.className = `log-entry ${type}`;
    entry.innerHTML = `<span class="log-time">[${timestamp()}]</span><span>${msg}</span>`;
    logContainer.appendChild(entry);
    logContainer.scrollTop = logContainer.scrollHeight;
}

function clearLog() {
    logContainer.innerHTML = '';
}

function highlightNodes(ids) {
    ids.forEach(id => {
        const el = document.getElementById(id);
        if (el) el.classList.add('highlight');
    });
}

function clearNodes() {
    document.querySelectorAll('.node').forEach(n => {
        n.classList.remove('highlight', 'blocked', 'attacked');
    });
}

function activateLayers(ids) {
    ids.forEach(id => {
        const el = document.getElementById(id);
        if (el) el.classList.add('active');
    });
}

function clearLayers() {
    document.querySelectorAll('.defense-layer').forEach(l => l.classList.remove('active'));
}

function showTab(name) {
    tabBtns.forEach(b => b.classList.toggle('active', b.dataset.tab === name));
    document.querySelectorAll('.tab-content').forEach(c => {
        c.classList.toggle('active', c.id === `tab-${name}`);
    });
}

function updateExplanation(attack) {
    document.getElementById('whContent').innerHTML = attack.whatsHappening;
    document.getElementById('analogyContent').innerHTML = attack.analogy;
    document.getElementById('whyMatters').innerHTML = attack.whyMatters;
}

function updateCode(attack) {
    document.getElementById('codePlaceholder').style.display = 'none';
    const display = document.getElementById('codeDisplay');
    display.style.display = 'block';
    display.innerHTML = attack.code;
}

function updateFinding(attack) {
    document.getElementById('findingPlaceholder').style.display = 'none';
    const display = document.getElementById('findingDisplay');
    display.style.display = 'block';
    
    const f = attack.finding;
    display.innerHTML = `
        <div class="finding-card">
            <div class="finding-header">
                <div class="finding-type">${f.type}</div>
                <div class="finding-severity">${f.severity}</div>
            </div>
            <div class="finding-body">
                <div class="finding-title">${f.title}</div>
                <div class="finding-desc">${f.description}</div>
                <div class="finding-json"><pre>${JSON.stringify(f.details, null, 2)}</pre></div>
            </div>
        </div>
    `;
}

function updateResponse(attack) {
    document.getElementById('responsePlaceholder').style.display = 'none';
    const display = document.getElementById('responseDisplay');
    display.style.display = 'block';
    display.innerHTML = attack.response;
}

// ============================================
// MAIN SIMULATION
// ============================================
async function runSimulation(attackId) {
    if (isSimulating) return;
    isSimulating = true;

    const attack = attacks[attackId];
    if (!attack) return;

    // Disable buttons
    attackBtns.forEach(b => b.disabled = true);
    attackBtns.forEach(b => b.classList.toggle('active', b.dataset.attack === attackId));

    // Reset visuals
    clearLog();
    clearNodes();
    clearLayers();
    blockedBanner.classList.remove('show');
    shield.classList.remove('active');
    attacker.classList.remove('active');

    // Update panels
    updateExplanation(attack);
    updateCode(attack);
    updateFinding(attack);
    updateResponse(attack);

    // Start
    log('info', `‚îÅ‚îÅ‚îÅ ${attack.title.toUpperCase()} ‚îÅ‚îÅ‚îÅ`);
    await sleep(400);

    // Show attacker
    attacker.classList.add('active');
    await sleep(500);

    // Highlight targets
    highlightNodes(attack.targetNodes);
    await sleep(300);

    // Run steps
    for (const step of attack.steps) {
        log(step.type, step.msg);
        
        if (step.type === 'success') {
            activateLayers(attack.defenseLayers);
        }
        
        await sleep(600);
    }

    // Block effect
    await sleep(300);
    attack.targetNodes.forEach(id => {
        const el = document.getElementById(id);
        if (el) {
            el.classList.remove('highlight');
            el.classList.add('blocked');
        }
    });

    shield.classList.add('active');
    await sleep(300);
    blockedBanner.classList.add('show');

    // Update stats
    attackCount++;
    alertCount++;
    document.getElementById('attacksBlocked').textContent = attackCount;
    document.getElementById('alertsGenerated').textContent = alertCount;

    await sleep(2000);

    // Reset
    blockedBanner.classList.remove('show');
    attacker.classList.remove('active');

    await sleep(400);

    attackBtns.forEach(b => {
        b.disabled = false;
        b.classList.remove('active');
    });

    isSimulating = false;
}

// ============================================
// EVENT LISTENERS
// ============================================
attackBtns.forEach(btn => {
    btn.addEventListener('click', () => runSimulation(btn.dataset.attack));
});

tabBtns.forEach(btn => {
    btn.addEventListener('click', () => showTab(btn.dataset.tab));
});

// Init
log('info', 'Security monitoring active');
log('success', '‚úì All defense layers operational');
</script>

</body>
</html>
