<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Security Simulator | AWS Student Data Infrastructure</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Interactive security simulator demonstrating how AWS protects student data from cyber attacks.">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%23232f3e' width='100' height='100' rx='8'/><text y='.9em' x='50%' text-anchor='middle' font-size='70' fill='%23ff9900'>‚òÅ</text></svg>">
    <style>
        /* Page-level layout built on top of the AWS console theme */
        .sim-header {
            margin-top: 16px;
            margin-bottom: 16px;
        }

        .sim-title-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            gap: 16px;
            margin-bottom: 8px;
        }

        .sim-title-row h1 {
            border-bottom: none;
            margin-bottom: 4px;
        }

        .sim-subtitle {
            color: var(--aws-text-secondary);
            font-size: 13px;
            max-width: 640px;
        }

        .simulator-grid {
            display: grid;
            grid-template-columns: 300px minmax(0, 1.4fr) minmax(0, 1fr);
            gap: 16px;
            align-items: flex-start;
        }

        .sim-left,
        .sim-center,
        .sim-right {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .sim-stats {
            margin-bottom: 16px;
        }

        .sim-metrics {
            margin-top: 8px;
        }

        /* Attack scenario buttons reuse AWS attack-button styles but tuned for panel */
        .attack-list-header {
            margin-bottom: 8px;
            font-size: 12px;
            color: var(--aws-text-tertiary);
        }

        .attack-button + .attack-button {
            margin-top: 8px;
        }

        .attack-button .threat-badge {
            font-size: 10px;
            text-transform: uppercase;
            padding: 2px 6px;
            border-radius: var(--aws-radius);
            border: 1px solid rgba(0, 0, 0, 0.2);
        }

        .threat-high    { background: rgba(209, 50, 18, 0.12);  border-color: var(--aws-red);    color: var(--aws-red-light); }
        .threat-medium { background: rgba(255, 153, 0, 0.08); border-color: var(--aws-yellow); color: var(--aws-yellow); }
        .threat-critical { background: rgba(123, 97, 255, 0.12); border-color: #7b61ff; color: #e5deff; }

        .attack-title-row {
            display: flex;
            justify-content: space-between;
            gap: 8px;
            align-items: center;
            margin-bottom: 4px;
        }

        .attack-sub {
            font-size: 11px;
            color: var(--aws-text-tertiary);
        }

        /* Visualization area */
        .architecture-container {
            position: relative;
            background: var(--aws-panel-bg);
            border-radius: var(--aws-radius-lg);
            border: 1px solid var(--aws-border);
            padding: 20px 20px 16px 52px;
            overflow: hidden;
        }

        .arch-label {
            position: absolute;
            top: 10px;
            left: 16px;
            font-size: 10px;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            color: var(--aws-text-tertiary);
        }

        .architecture-diagram {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 24px;
            margin-top: 12px;
            max-width: 520px;      /* constrain row so RDS isn't at card edge */
            margin-left: auto;
            margin-right: auto;
        }

        .connections-svg {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .connection {
            stroke: var(--aws-border-light);
            stroke-width: 2;
            stroke-dasharray: 6 4;
            fill: none;
        }

        .node {
            background: var(--aws-card-bg);
            border-radius: var(--aws-radius);
            border: 1px solid var(--aws-border);
            padding: 12px 14px;
            min-width: 120px;
            text-align: center;
            box-shadow: var(--aws-shadow-sm);
            transition: border-color 0.2s ease, background 0.2s ease, transform 0.2s ease;
        }

        .node-icon {
            width: 36px;
            height: 36px;
            margin: 0 auto 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--aws-radius);
            background: var(--aws-panel-bg);
            font-size: 18px;
        }

        .node-name {
            font-size: 12px;
            font-weight: 700;
            color: var(--aws-text-primary);
            margin-bottom: 2px;
        }

        .node-detail {
            font-size: 11px;
            color: var(--aws-text-tertiary);
        }

        .node.highlight {
            border-color: var(--aws-yellow);
            background: #293541;
            transform: translateY(-1px);
        }

        .node.blocked {
            border-color: var(--aws-green);
            background: rgba(29, 129, 2, 0.15);
        }

        .attacker {
            position: absolute;
            left: 8px;
            top: 50%;
            transform: translateY(-50%) translateX(-40px);
            width: 40px;
            height: 40px;
            border-radius: 999px;
            background: linear-gradient(135deg, var(--aws-red), var(--aws-red-light));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: 0 0 12px rgba(209, 50, 18, 0.6);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .attacker.active {
            opacity: 1;
            transform: translateY(-50%) translateX(0);
        }

        .shield {
            position: absolute;
            inset: 50% auto auto 50%;
            transform: translate(-50%, -50%) scale(0.8);
            width: 80px;
            height: 80px;
            border-radius: 999px;
            border: 2px solid var(--aws-green-light);
            opacity: 0;
            pointer-events: none;
        }

        .shield.active {
            animation: shieldPulse 0.6s ease-out forwards;
        }

        @keyframes shieldPulse {
            0%   { opacity: 0; transform: translate(-50%, -50%) scale(0.4); }
            40%  { opacity: 1; transform: translate(-50%, -50%) scale(1.0); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1.6); }
        }

        .blocked-banner {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            background: var(--aws-green);
            color: #fff;
            padding: 10px 18px;
            border-radius: var(--aws-radius-lg);
            font-size: 13px;
            font-weight: 700;
            opacity: 0;
            box-shadow: var(--aws-shadow-lg);
            white-space: nowrap;
        }

        .blocked-banner.show {
            animation: bannerIn 0.35s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
        }

        @keyframes bannerIn {
            from { opacity: 0; transform: translate(-50%, -50%) scale(0.7); }
            to   { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }

        .defense-layers {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 16px;
        }

        .defense-layer {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 8px;
            border-radius: var(--aws-radius);
            border: 1px solid var(--aws-border);
            background: var(--aws-card-bg);
            font-size: 11px;
            color: var(--aws-text-tertiary);
        }

        .defense-layer .dot {
            width: 6px;
            height: 6px;
            border-radius: 999px;
            background: var(--aws-border-light);
        }

        .defense-layer.active {
            border-color: var(--aws-green-light);
            background: rgba(29, 129, 2, 0.18);
            color: var(--aws-green-light);
        }

        .defense-layer.active .dot {
            background: var(--aws-green-light);
            box-shadow: 0 0 8px rgba(46, 160, 67, 0.7);
        }

        /* Event log uses console-output styles */
        .log-entry {
            display: flex;
            gap: 8px;
            padding: 2px 0;
            font-size: 12px;
            font-family: Monaco, Menlo, monospace;
            animation: fadeInUp 0.15s ease-out;
        }

        .log-time {
            opacity: 0.7;
            flex-shrink: 0;
            width: 90px;
        }

        .log-entry.info    { color: var(--aws-blue-light); }
        .log-entry.warning { color: var(--aws-yellow); }
        .log-entry.success { color: var(--aws-green-light); }
        .log-entry.error   { color: var(--aws-red-light); }

        /* Tabs */
        .tabs-nav {
            display: flex;
            border-bottom: 1px solid var(--aws-border);
            background: var(--aws-panel-bg);
        }

        .tab-btn {
            flex: 1;
            padding: 8px 10px;
            border: none;
            background: transparent;
            color: var(--aws-text-tertiary);
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
            transition: background 0.15s ease, color 0.15s ease;
        }

        .tab-btn.active {
            color: var(--aws-orange);
            background: var(--aws-card-bg);
        }

        .tab-content {
            display: none;
            padding: 12px 14px;
        }

        .tab-content.active {
            display: block;
        }

        .code-block {
            background: var(--aws-squid-ink-dark);
            border-radius: var(--aws-radius);
            padding: 12px;
            font-family: Monaco, Menlo, monospace;
            font-size: 12px;
            color: var(--aws-text-secondary);
            overflow-x: auto;
        }

        .code-block .comment { color: #7f8c8d; }
        .code-block .keyword { color: #cba6f7; }
        .code-block .string  { color: #a6e3a1; }
        .code-block .function { color: #89b4fa; }

        .finding-card {
            border-radius: var(--aws-radius);
            border: 1px solid var(--aws-red);
            overflow: hidden;
        }

        .finding-header {
            background: rgba(209, 50, 18, 0.12);
            padding: 8px 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .finding-type {
            font-family: Monaco, Menlo, monospace;
            font-size: 11px;
            color: var(--aws-red-light);
        }

        .finding-severity {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: var(--aws-radius);
            background: var(--aws-red);
            color: #fff;
            font-weight: 700;
            text-transform: uppercase;
        }

        .finding-body {
            padding: 10px 12px 12px;
        }

        .finding-title {
            font-size: 13px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .finding-desc {
            font-size: 12px;
            color: var(--aws-text-secondary);
            margin-bottom: 8px;
        }

        .finding-json {
            background: var(--aws-squid-ink-dark);
            padding: 8px;
            border-radius: var(--aws-radius);
            font-size: 11px;
            max-height: 140px;
            overflow: auto;
            color: var(--aws-text-secondary);
        }

        .placeholder {
            text-align: center;
            padding: 16px;
            color: var(--aws-text-tertiary);
            font-size: 12px;
        }

        .runbook {
            font-size: 12px;
            color: var(--aws-text-secondary);
            line-height: 1.6;
        }

        .runbook pre {
            background: var(--aws-squid-ink-dark);
            padding: 8px;
            border-radius: var(--aws-radius);
            overflow-x: auto;
            font-size: 11px;
            margin: 6px 0 8px;
        }

        .runbook h4 {
            margin: 10px 0 4px;
            font-size: 12px;
            color: var(--aws-text-primary);
        }

        /* Right-side explanation */
        .whats-happening {
            background: linear-gradient(135deg, #244372, #16191f);
            border-radius: var(--aws-radius-lg);
            border: 1px solid var(--aws-border);
            padding: 16px 18px;
        }

        .wh-title {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
            color: var(--aws-text-tertiary);
        }

        .wh-content {
            font-size: 13px;
            color: var(--aws-text-secondary);
        }

        .analogy-card {
            border-radius: var(--aws-radius-lg);
            border: 1px solid var(--aws-border);
            background: var(--aws-panel-bg);
        }

        .analogy-header {
            padding: 10px 14px;
            border-bottom: 1px solid var(--aws-border);
            font-size: 12px;
            color: var(--aws-yellow);
            font-weight: 600;
        }

        .analogy-body {
            padding: 12px 14px 14px;
            font-size: 13px;
            color: var(--aws-text-secondary);
        }

        .emoji-icon {
            font-size: 18px;
            margin-right: 6px;
        }

        @media (max-width: 1200px) {
            .simulator-grid {
                grid-template-columns: minmax(0, 1fr);
            }

            .sim-left,
            .sim-center,
            .sim-right {
                width: 100%;
            }
        }

        @media (max-width: 768px) {
            .sim-title-row {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>

<header class="site-header">
    <div>
        <a href="index.html" class="logo">
            <span class="logo-icon">‚òÅ</span>
            AWS Student Data Infrastructure
        </a>
        <nav class="nav-links">
            <a href="index.html">Home</a>
            <a href="architecture.html">Architecture</a>
            <a href="automation.html">IAM Automation</a>
            <a href="docs.html">Documentation</a>
            <a href="review.html">Project Review</a>
            <a href="live-demo.html">Live Demo</a>
            <a href="interactive-diagram.html">Interactive Diagram</a>
            <a href="cost-calculator.html">Cost Calculator</a>
            <a href="security-simulator.html" class="active">Security Simulator</a>
        </nav>
        <button class="mobile-menu-toggle" aria-label="Toggle navigation menu">
            <span></span>
            <span></span>
            <span></span>
        </button>
    </div>
</header>

<main class="content">
    <section class="sim-header">
        <div class="sim-title-row">
            <div>
                <h1>Security Attack Simulator</h1>
                <p class="sim-subtitle">
                    Replay realistic attack paths against this student data environment and watch how each
                    AWS control activates in sequence&mdash;from network isolation, to IAM, to GuardDuty alerts.
                </p>
            </div>
            <div class="info-badge">
                <span class="icon icon-info"></span>
                Fully simulated &mdash; no real AWS calls are made.
            </div>
        </div>
    </section>

    <section class="card sim-stats">
        <h2>Live Security Posture</h2>
        <div class="metrics-grid sim-metrics">
            <div class="metric-card">
                <div class="metric-value success" id="attacksBlocked">0</div>
                <div class="metric-label">Attacks Blocked</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="alertsGenerated">0</div>
                <div class="metric-label">Security Alerts Generated</div>
            </div>
            <div class="metric-card">
                <div class="metric-value success">100%</div>
                <div class="metric-label">Detection Rate (Simulated)</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">0</div>
                <div class="metric-label">Data Breaches</div>
            </div>
        </div>
    </section>

    <section class="simulator-grid">
        <!-- Left: Attack Scenarios -->
        <aside class="sim-left">
            <div class="card">
                <div class="breadcrumb mb-sm">
                    <span>Security</span>
                    <span class="breadcrumb-separator"></span>
                    <span>Attack Scenarios</span>
                </div>
                <div class="attack-list-header">
                    Select an attack to launch a guided simulation of how this architecture responds.
                </div>

                <button class="attack-button" data-attack="direct-db">
                    <div class="attack-title-row">
                        <span class="attack-title">Direct Database Access</span>
                        <span class="threat-badge threat-high">High</span>
                    </div>
                    <div class="attack-desc">Hacker attempts to connect straight to the RDS database from the internet.</div>
                </button>

                <button class="attack-button" data-attack="privilege-escalation">
                    <div class="attack-title-row">
                        <span class="attack-title">Privilege Escalation</span>
                        <span class="threat-badge threat-medium">Medium</span>
                    </div>
                    <div class="attack-desc">User tries to grant themselves administrator-level permissions.</div>
                </button>

                <button class="attack-button" data-attack="s3-public">
                    <div class="attack-title-row">
                        <span class="attack-title">Data Exposure Attempt</span>
                        <span class="threat-badge threat-critical">Critical</span>
                    </div>
                    <div class="attack-desc">Misconfiguring S3 to make private student records publicly readable.</div>
                </button>

                <button class="attack-button" data-attack="credential-theft">
                    <div class="attack-title-row">
                        <span class="attack-title">Stolen Credentials</span>
                        <span class="threat-badge threat-high">High</span>
                    </div>
                    <div class="attack-desc">Compromised IAM credentials used from an unusual location.</div>
                </button>

                <button class="attack-button" data-attack="port-scan">
                    <div class="attack-title-row">
                        <span class="attack-title">Network Reconnaissance</span>
                        <span class="threat-badge threat-medium">Medium</span>
                    </div>
                    <div class="attack-desc">Aggressive port scanning against app and database tiers.</div>
                </button>

                <button class="attack-button" data-attack="data-theft">
                    <div class="attack-title-row">
                        <span class="attack-title">Mass Data Download</span>
                        <span class="threat-badge threat-high">High</span>
                    </div>
                    <div class="attack-desc">Unusual bulk export of transcripts from secure storage.</div>
                </button>
            </div>
        </aside>

        <!-- Center: Visualization + Log + Technical Detail -->
        <div class="sim-center">
            <div class="architecture-container">
                <div class="arch-label">Three-Tier VPC Path</div>

                <svg class="connections-svg" viewBox="0 0 600 200" preserveAspectRatio="xMidYMid meet">
                    <path id="conn1" class="connection" d="M100,100 L200,100" />
                    <path id="conn2" class="connection" d="M260,100 L360,100" />
                    <path id="conn3" class="connection" d="M420,100 L520,100" />
                </svg>

                <div class="architecture-diagram">
                    <div class="attacker" id="attacker">ü•∑</div>

                    <div class="node" id="node-internet">
                        <div class="node-icon">üåê</div>
                        <div class="node-name">Internet</div>
                        <div class="node-detail">Untrusted</div>
                    </div>

                    <div class="node" id="node-gateway">
                        <div class="node-icon">üöß</div>
                        <div class="node-name">Entry Gateway</div>
                        <div class="node-detail">ALB + (WAF-ready)</div>
                    </div>

                    <div class="node" id="node-app">
                        <div class="node-icon">‚öôÔ∏è</div>
                        <div class="node-name">App Tier</div>
                        <div class="node-detail">Private Subnets</div>
                    </div>

                    <div class="node" id="node-db">
                        <div class="node-icon">üóÑÔ∏è</div>
                        <div class="node-name">RDS Tier</div>
                        <div class="node-detail">Isolated Subnets</div>
                    </div>

                    <div class="shield" id="shield"></div>
                    <div class="blocked-banner" id="blockedBanner">‚úì Attack blocked by defense-in-depth</div>
                </div>

                <div class="defense-layers mt-sm">
                    <div class="defense-layer" id="layer-sg">
                        <span class="dot"></span>
                        Security Groups (tier-to-tier)
                    </div>
                    <div class="defense-layer" id="layer-nacl">
                        <span class="dot"></span>
                        Network ACLs
                    </div>
                    <div class="defense-layer" id="layer-iam">
                        <span class="dot"></span>
                        IAM &amp; SCPs
                    </div>
                    <div class="defense-layer" id="layer-encryption">
                        <span class="dot"></span>
                        KMS Encryption
                    </div>
                    <div class="defense-layer" id="layer-monitoring">
                        <span class="dot"></span>
                        GuardDuty &amp; CloudTrail
                    </div>
                </div>
            </div>

            <div class="state-section mt-md">
                <h3>Security Event Stream</h3>
                <div class="console-output" id="logContainer">
                    <div class="console-line info" style="margin-bottom: 4px;">
                        [--:--:--] Security monitoring active. Select an attack scenario to begin.
                    </div>
                    <div class="console-line success">
                        [--:--:--] ‚úì All tiers isolated; IAM and logging are enabled.
                    </div>
                </div>
            </div>

            <div class="tech-tabs mt-md">
                <div class="tabs-nav">
                    <button class="tab-btn active" data-tab="code">Attack Code</button>
                    <button class="tab-btn" data-tab="finding">Security Alert</button>
                    <button class="tab-btn" data-tab="response">Response Runbook</button>
                </div>
                <div class="tab-content active" id="tab-code">
                    <div class="placeholder" id="codePlaceholder">
                        üíª Select an attack on the left to see what the attacker would run.
                    </div>
                    <div class="code-block" id="codeDisplay" style="display: none;"></div>
                </div>
                <div class="tab-content" id="tab-finding">
                    <div class="placeholder" id="findingPlaceholder">
                        üîç When an attack runs, a GuardDuty-style finding will be rendered here.
                    </div>
                    <div id="findingDisplay" style="display: none;"></div>
                </div>
                <div class="tab-content" id="tab-response">
                    <div class="placeholder" id="responsePlaceholder">
                        üõ†Ô∏è You‚Äôll see incident response steps for each scenario here.
                    </div>
                    <div class="runbook" id="responseDisplay" style="display: none;"></div>
                </div>
            </div>
        </div>

        <!-- Right: Narrative & context -->
        <aside class="sim-right">
            <div class="whats-happening" id="whatsHappening">
                <div class="wh-title">
                    üí° What‚Äôs happening in this simulation
                </div>
                <div class="wh-content" id="whContent">
                    This simulator walks through realistic attack paths against a FERPA-aligned AWS environment.
                    Each step shows which control fires (network, IAM, encryption, or monitoring) and why the
                    attacker ultimately fails.
                </div>
            </div>

            <div class="analogy-card" id="analogyCard">
                <div class="analogy-header">
                    Real-world analogy
                </div>
                <div class="analogy-body" id="analogyContent">
                    <span class="emoji-icon">üè¢</span>
                    Think of a secured university records office: a receptionist up front, badge-locked doors between
                    zones, cameras everywhere, and strict rules on who can open the filing cabinets. This AWS design
                    applies the same concept in the cloud.
                </div>
            </div>

            <div class="card">
                <h2>Why this matters for student data</h2>
                <p id="whyMatters">
                    Student information systems hold grades, addresses, and financial aid details. A single misconfigured
                    control can turn into a reportable breach. These simulations mirror the kind of attacks that actually
                    hit universities and show how layered AWS controls help keep FERPA-regulated data safe.
                </p>
            </div>
        </aside>
    </section>
</main>

<script>
// ============================================
// STATE
// ============================================
let isSimulating = false;
let attackCount = 0;
let alertCount = 0;

// ============================================
// ATTACK DATA
// ============================================
const attacks = {
    "direct-db": {
        title: "Direct Database Access",
        targetNodes: ["node-internet", "node-db"],
        defenseLayers: ["layer-sg", "layer-nacl"],
        // Plain English explanation
        whatsHappening: `A hacker is trying to <strong>connect directly to our database</strong> from the internet ‚Äî like trying to walk straight into a bank vault from the street.
        <br><br>
        Our security stops this because the database is in a <strong>private network</strong> with no public address. It's literally unreachable from outside.`,
        analogy: `<span class="emoji-icon">üè¶</span>
        Imagine a bank vault that's <strong>underground with no entrance from the street</strong>. 
        You can only reach it through the bank lobby, then past the tellers, then through a secured door. 
        The hacker is trying to dig a tunnel directly to the vault ‚Äî but there's no path there.`,
        whyMatters: `If hackers could connect directly to databases, they could <strong>steal all student records instantly</strong> ‚Äî names, grades, social security numbers, everything. 
        Our network isolation makes this physically impossible.`,
        code: `<span class="comment"># Hacker's attempt to connect directly to database</span>
<span class="keyword">import</span> psycopg2

<span class="comment"># This connection will FAIL because:</span>
<span class="comment"># 1. Database has no public IP address</span>
<span class="comment"># 2. Security Groups only allow app servers</span>
<span class="comment"># 3. No route exists from internet to DB subnet</span>

conn = psycopg2.connect(
    host=<span class="string">"student-db.aws-region.rds.amazonaws.com"</span>,
    port=<span class="string">5432</span>,
    user=<span class="string">"hacker"</span>,
    password=<span class="string">"stolen_password"</span>
)
<span class="comment"># Result: Connection timeout - no network path exists</span>`,
        finding: {
            type: "UnauthorizedAccess:EC2/MaliciousIPCaller",
            severity: "HIGH",
            title: "Blocked connection attempt from suspicious IP",
            description: "Someone tried to connect to a protected resource from an IP address that shouldn't have access.",
            details: { "SourceIP": "203.0.113.45", "TargetPort": 5432, "Action": "BLOCKED", "Reason": "No network route exists" }
        },
        response: `<h4>1. What Our System Did Automatically</h4>
<ul>
<li>Blocked the connection (no network path exists)</li>
<li>Logged the attempt in VPC Flow Logs</li>
<li>Generated a security alert</li>
</ul>

<h4>2. What a Security Team Would Check</h4>
<pre># View blocked connection attempts
aws logs filter-log-events \\
  --log-group-name /aws/vpc/flowlogs \\
  --filter-pattern "REJECT"</pre>

<h4>3. No Action Needed</h4>
<p>The architecture itself prevents this attack. There's nothing to "fix" ‚Äî the security worked exactly as designed.</p>`,
        steps: [
            { type: "info", msg: "Incoming connection from external IP: 203.0.113.45" },
            { type: "warning", msg: "Target: Database server on port 5432" },
            { type: "info", msg: "Checking network routes..." },
            { type: "success", msg: "‚úì Database subnet has no internet gateway" },
            { type: "success", msg: "‚úì Database has no public IP address" },
            { type: "info", msg: "Checking Security Group rules..." },
            { type: "success", msg: "‚úì Only application servers can connect to database" },
            { type: "error", msg: "‚ùå CONNECTION BLOCKED ‚Äî No path to database exists" }
        ]
    },

    "privilege-escalation": {
        title: "Privilege Escalation",
        targetNodes: ["node-app"],
        defenseLayers: ["layer-iam", "layer-monitoring"],
        whatsHappening: `A user with <strong>limited access</strong> (like a student worker) is trying to <strong>give themselves admin powers</strong>.
        <br><br>
        This is like a cashier trying to promote themselves to bank manager. Our permission system says "nice try, but no."`,
        analogy: `<span class="emoji-icon">üîë</span>
        Imagine an employee with a <strong>key to the supply closet</strong> trying to make a copy of the <strong>master key</strong> that opens every door. 
        The key-making machine checks their badge and says "You're not authorized to copy master keys" ‚Äî and logs the suspicious request.`,
        whyMatters: `If users could grant themselves admin access, a disgruntled employee could <strong>delete all records</strong>, 
        <strong>steal sensitive data</strong>, or <strong>lock everyone else out</strong>. IAM policies prevent this.`,
        code: `<span class="comment"># User tries to give themselves admin access</span>
<span class="keyword">import</span> boto3

iam = boto3.client(<span class="string">'iam'</span>)

<span class="comment"># Attempting to attach the most powerful policy</span>
<span class="keyword">try</span>:
    iam.attach_user_policy(
        UserName=<span class="string">'student_worker'</span>,
        PolicyArn=<span class="string">'arn:aws:iam::aws:policy/AdministratorAccess'</span>
    )
<span class="keyword">except</span> Exception <span class="keyword">as</span> e:
    print(<span class="string">"Access Denied: You cannot modify permissions"</span>)
    
<span class="comment"># AWS logs this failed attempt in CloudTrail</span>`,
        finding: {
            type: "PrivilegeEscalation:IAMUser/AnomalousBehavior",
            severity: "MEDIUM",
            title: "User attempted to escalate their own privileges",
            description: "A user tried to attach admin permissions to their account. This was blocked by IAM policies.",
            details: { "User": "student_worker", "AttemptedAction": "AttachUserPolicy", "TargetPolicy": "AdministratorAccess", "Result": "AccessDenied" }
        },
        response: `<h4>1. Immediate Response</h4>
<pre># Temporarily restrict the suspicious user
aws iam put-user-policy --user-name student_worker \\
  --policy-name TempRestriction \\
  --policy-document '{"Version":"2012-10-17","Statement":[{"Effect":"Deny","Action":"iam:*","Resource":"*"}]}'</pre>

<h4>2. Investigate</h4>
<ul>
<li>Was this a mistake or intentional?</li>
<li>Has this user made other suspicious requests?</li>
<li>Check CloudTrail for recent activity</li>
</ul>

<h4>3. Follow Up</h4>
<p>Contact the user's supervisor. If intentional, escalate to security team.</p>`,
        steps: [
            { type: "info", msg: "API call detected: iam:AttachUserPolicy" },
            { type: "warning", msg: "User 'student_worker' requesting admin access" },
            { type: "info", msg: "Checking user's permissions..." },
            { type: "success", msg: "‚úì User lacks permission to modify IAM policies" },
            { type: "info", msg: "Logging attempt to CloudTrail..." },
            { type: "info", msg: "GuardDuty analyzing behavior pattern..." },
            { type: "error", msg: "‚ùå ACCESS DENIED ‚Äî Cannot escalate privileges" }
        ]
    },

    "s3-public": {
        title: "Data Exposure Attempt",
        targetNodes: ["node-app"],
        defenseLayers: ["layer-encryption", "layer-monitoring"],
        whatsHappening: `Someone is trying to make our <strong>private student files publicly accessible</strong> on the internet ‚Äî like posting confidential records on a public bulletin board.
        <br><br>
        AWS has a safety switch called <strong>"Block Public Access"</strong> that prevents this, even if someone tries really hard.`,
        analogy: `<span class="emoji-icon">üìÅ</span>
        Imagine a filing cabinet with a <strong>special lock that prevents the drawer from being left open</strong>. 
        Even if someone tries to prop it open, the lock automatically closes it. 
        Our S3 buckets have this "auto-close" feature built in.`,
        whyMatters: `Exposed student data could lead to <strong>identity theft</strong>, <strong>FERPA violations</strong>, 
        and <strong>lawsuits</strong>. Block Public Access is a safety net that catches mistakes and malicious actions.`,
        code: `<span class="comment"># Attempting to make student files public</span>
<span class="keyword">import</span> boto3

s3 = boto3.client(<span class="string">'s3'</span>)

<span class="comment"># Try to make bucket publicly readable</span>
<span class="keyword">try</span>:
    s3.put_bucket_acl(
        Bucket=<span class="string">'student-records-bucket'</span>,
        ACL=<span class="string">'public-read'</span>  <span class="comment"># This would expose all files!</span>
    )
<span class="keyword">except</span> Exception <span class="keyword">as</span> e:
    print(<span class="string">"Blocked by S3 Block Public Access"</span>)

<span class="comment"># The setting physically prevents public access</span>`,
        finding: {
            type: "Policy:S3/BucketPublicAccessGranted",
            severity: "CRITICAL",
            title: "Attempt to make private data public was blocked",
            description: "Someone tried to change bucket permissions to allow public access. S3 Block Public Access prevented this.",
            details: { "Bucket": "student-records-bucket", "AttemptedACL": "public-read", "BlockedBy": "S3 Block Public Access", "AccountLevel": true }
        },
        response: `<h4>1. Verify Protection is Active</h4>
<pre># Check that Block Public Access is enabled
aws s3api get-public-access-block \\
  --bucket student-records-bucket</pre>

<h4>2. Identify Who Tried This</h4>
<pre># Check CloudTrail for the attempt
aws cloudtrail lookup-events \\
  --lookup-attributes AttributeKey=EventName,AttributeValue=PutBucketAcl</pre>

<h4>3. Review Access</h4>
<p>Determine if this user should have bucket permissions at all. Consider restricting access.</p>`,
        steps: [
            { type: "info", msg: "API call: s3:PutBucketAcl" },
            { type: "warning", msg: "Requested permission: public-read" },
            { type: "info", msg: "Checking S3 Block Public Access..." },
            { type: "success", msg: "‚úì BlockPublicAcls: ENABLED" },
            { type: "success", msg: "‚úì BlockPublicPolicy: ENABLED" },
            { type: "info", msg: "Logging blocked attempt..." },
            { type: "error", msg: "‚ùå BLOCKED ‚Äî Public access is not allowed" }
        ]
    },

    "credential-theft": {
        title: "Stolen Credentials",
        targetNodes: ["node-internet", "node-gateway", "node-app"],
        defenseLayers: ["layer-monitoring"],
        whatsHappening: `Someone <strong>stole login credentials</strong> (maybe through phishing) and is now using them from a <strong>different country</strong>.
        <br><br>
        Our monitoring system notices: "Wait, this user normally logs in from New York, but now they're suddenly in Russia?" üö®`,
        analogy: `<span class="emoji-icon">üí≥</span>
        It's like your credit card company calling to ask: "Did you just buy something in Nigeria? You were in Texas an hour ago." 
        They detect <strong>impossible travel</strong> ‚Äî and so does our system.`,
        whyMatters: `Stolen credentials are the #1 way hackers get into systems. 
        Even with a valid password, <strong>behavioral detection</strong> catches when something doesn't add up.`,
        code: `<span class="comment"># Hacker using stolen credentials from unusual location</span>
<span class="keyword">import</span> boto3

<span class="comment"># These are real credentials stolen via phishing</span>
<span class="comment"># The hacker is in Dublin, but the real user is in NYC</span>

session = boto3.Session(
    aws_access_key_id=<span class="string">'AKIA_STOLEN_KEY'</span>,
    aws_secret_access_key=<span class="string">'stolen_secret'</span>,
    region_name=<span class="string">'eu-west-1'</span>  <span class="comment"># Different region!</span>
)

ec2 = session.client(<span class="string">'ec2'</span>)

<span class="comment"># Rapid API calls trigger anomaly detection</span>
<span class="keyword">for</span> i <span class="keyword">in</span> range(50):
    ec2.describe_instances()
    
<span class="comment"># GuardDuty: "This user never uses eu-west-1..."</span>`,
        finding: {
            type: "UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration",
            severity: "HIGH",
            title: "Credentials used from unusual location",
            description: "Login credentials are being used from an IP address in a different geographic location than normal. Possible credential theft.",
            details: { "NormalLocation": "New York, USA", "CurrentLocation": "Dublin, Ireland", "UnusualAPICount": 50, "TimeWindow": "2 minutes" }
        },
        response: `<h4>1. Disable Credentials Immediately</h4>
<pre># Disable the compromised access key
aws iam update-access-key \\
  --access-key-id AKIA_STOLEN_KEY \\
  --status Inactive</pre>

<h4>2. Check What They Did</h4>
<pre># Review all actions taken with these credentials
aws cloudtrail lookup-events \\
  --lookup-attributes AttributeKey=AccessKeyId,AttributeValue=AKIA_STOLEN_KEY</pre>

<h4>3. Contact the Real User</h4>
<ul>
<li>Confirm they didn't travel to Dublin</li>
<li>Have them change their password</li>
<li>Enable MFA if not already active</li>
</ul>`,
        steps: [
            { type: "warning", msg: "Login from unusual location: Dublin, Ireland" },
            { type: "info", msg: "User baseline: New York, USA" },
            { type: "warning", msg: "50 API calls in 2 minutes (abnormal)" },
            { type: "info", msg: "GuardDuty analyzing patterns..." },
            { type: "success", msg: "‚úì Anomaly detected: Impossible travel" },
            { type: "error", msg: "‚ö†Ô∏è HIGH SEVERITY ALERT generated" },
            { type: "success", msg: "‚úì Automated response: Credentials disabled" }
        ]
    },

    "port-scan": {
        title: "Network Reconnaissance",
        targetNodes: ["node-app", "node-db"],
        defenseLayers: ["layer-sg", "layer-nacl", "layer-monitoring"],
        whatsHappening: `A hacker is <strong>scanning our network</strong> to find open doors ‚Äî checking thousands of ports to see what services are running.
        <br><br>
        This is like a burglar walking down a street, <strong>trying every door handle</strong> to see which ones are unlocked.`,
        analogy: `<span class="emoji-icon">üö™</span>
        Imagine someone walking down your street, <strong>jiggling every door handle</strong> on every house. 
        Even if all doors are locked, it's suspicious behavior! Our system notices this "jiggling" and alerts us.`,
        whyMatters: `Port scanning is often the <strong>first step before an attack</strong>. 
        By detecting it early, we know someone is probing our defenses and can watch them closely.`,
        code: `<span class="comment"># Hacker scanning for open ports</span>
<span class="keyword">import</span> socket
<span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor

target = <span class="string">"172.32.20.0/24"</span>  <span class="comment"># Database subnet</span>
ports = [22, 80, 443, 3306, 5432, 27017]

<span class="keyword">def</span> <span class="function">scan_port</span>(ip, port):
    sock = socket.socket()
    sock.settimeout(0.1)
    result = sock.connect_ex((ip, port))
    <span class="keyword">if</span> result == 0:
        print(<span class="string">f"Port {port} open on {ip}"</span>)
    sock.close()

<span class="comment"># Rapid scanning creates thousands of REJECT log entries</span>
<span class="comment"># GuardDuty correlates this as reconnaissance</span>`,
        finding: {
            type: "Recon:EC2/PortScan",
            severity: "MEDIUM",
            title: "Port scanning activity detected",
            description: "An instance is probing multiple ports on other hosts. This is typically reconnaissance before an attack.",
            details: { "SourceIP": "172.32.10.55", "TargetSubnet": "172.32.20.0/24", "PortsScanned": 6, "ConnectionAttempts": 2048 }
        },
        response: `<h4>1. Identify the Scanner</h4>
<pre># Find the instance doing the scanning
aws ec2 describe-instances \\
  --filters "Name=private-ip-address,Values=172.32.10.55"</pre>

<h4>2. Isolate if Compromised</h4>
<pre># Move to isolation security group
aws ec2 modify-instance-attribute \\
  --instance-id i-xxxxx \\
  --groups sg-isolation</pre>

<h4>3. Investigate</h4>
<ul>
<li>Is this a legitimate security scan?</li>
<li>Was the instance compromised?</li>
<li>Check for malware or unauthorized software</li>
</ul>`,
        steps: [
            { type: "warning", msg: "Unusual network activity from 172.32.10.55" },
            { type: "info", msg: "Scanning database subnet: 172.32.20.0/24" },
            { type: "info", msg: "Ports checked: 22, 80, 443, 3306, 5432..." },
            { type: "success", msg: "‚úì All connection attempts REJECTED" },
            { type: "success", msg: "‚úì VPC Flow Logs capturing activity" },
            { type: "info", msg: "GuardDuty correlating network patterns..." },
            { type: "error", msg: "‚ö†Ô∏è ALERT: Reconnaissance detected" }
        ]
    },

    "data-theft": {
        title: "Mass Data Download",
        targetNodes: ["node-app"],
        defenseLayers: ["layer-iam", "layer-monitoring"],
        whatsHappening: `Someone is <strong>downloading huge amounts of student data</strong> very quickly ‚Äî way more than normal usage would require.
        <br><br>
        Our monitoring notices: "This user usually downloads 5 files a day. Why are they suddenly grabbing 500 files in 10 minutes?"`,
        analogy: `<span class="emoji-icon">üìö</span>
        Imagine a library where you normally check out 2-3 books. Suddenly you're loading <strong>a shopping cart with 500 books</strong>. 
        The librarian would definitely ask questions! Our system does the same thing.`,
        whyMatters: `Data exfiltration is how breaches happen. 
        Even if someone has legitimate access, <strong>unusual download patterns</strong> could mean they're stealing data to sell or leak.`,
        code: `<span class="comment"># Attempting to download massive amounts of data</span>
<span class="keyword">import</span> boto3

s3 = boto3.client(<span class="string">'s3'</span>)

<span class="comment"># List all sensitive files</span>
objects = s3.list_objects_v2(
    Bucket=<span class="string">'student-records'</span>,
    Prefix=<span class="string">'transcripts/'</span>
)

<span class="comment"># Download everything rapidly</span>
<span class="keyword">for</span> obj <span class="keyword">in</span> objects[<span class="string">'Contents'</span>]:
    s3.download_file(
        <span class="string">'student-records'</span>,
        obj[<span class="string">'Key'</span>],
        <span class="string">f"/tmp/{obj['Key']}"</span>
    )

<span class="comment"># This unusual volume triggers alerts</span>`,
        finding: {
            type: "Exfiltration:S3/ObjectRead.Unusual",
            severity: "HIGH",
            title: "Unusual data download pattern detected",
            description: "A user is downloading far more data than their normal baseline. This matches data exfiltration patterns.",
            details: { "FilesDownloaded": 127, "DataVolume": "52.4 MB", "TimeWindow": "15 minutes", "NormalBaseline": "5 files/day" }
        },
        response: `<h4>1. Restrict Access Immediately</h4>
<pre># Block the user's access to the bucket
aws s3api put-bucket-policy --bucket student-records \\
  --policy '{"Statement":[{"Effect":"Deny","Principal":{"AWS":"arn:aws:iam::xxx:user/suspect"},"Action":"s3:*","Resource":"*"}]}'</pre>

<h4>2. Assess Exposure</h4>
<ul>
<li>What files were downloaded?</li>
<li>Do they contain PII?</li>
<li>Is this a reportable breach?</li>
</ul>

<h4>3. Contact User</h4>
<p>There may be a legitimate reason (end of semester reports). But verify before restoring access.</p>`,
        steps: [
            { type: "warning", msg: "Unusual download volume: 127 files in 15 minutes" },
            { type: "info", msg: "User baseline: 5 files per day" },
            { type: "info", msg: "Data volume: 52.4 MB" },
            { type: "info", msg: "S3 access logs recording all activity..." },
            { type: "info", msg: "GuardDuty analyzing data transfer patterns..." },
            { type: "error", msg: "‚ö†Ô∏è ALERT: Possible data exfiltration" },
            { type: "success", msg: "‚úì Automated alert sent to security team" }
        ]
    }
};

// ============================================
// DOM ELEMENTS
// ============================================
const attackBtns = document.querySelectorAll('.attack-button');
const tabBtns = document.querySelectorAll('.tab-btn');
const logContainer = document.getElementById('logContainer');
const attacker = document.getElementById('attacker');
const shield = document.getElementById('shield');
const blockedBanner = document.getElementById('blockedBanner');

// ============================================
// HELPER FUNCTIONS
// ============================================
function sleep(ms) {
    return new Promise(r => setTimeout(r, ms));
}

function timestamp() {
    return new Date().toLocaleTimeString('en-US', { hour12: false });
}

function log(type, msg) {
    const entry = document.createElement('div');
    entry.className = `log-entry ${type}`;
    entry.innerHTML = `<span class="log-time">[${timestamp()}]</span><span>${msg}</span>`;
    logContainer.appendChild(entry);
    logContainer.scrollTop = logContainer.scrollHeight;
}

function clearLog() {
    logContainer.innerHTML = '';
}

function highlightNodes(ids) {
    ids.forEach(id => {
        const el = document.getElementById(id);
        if (el) el.classList.add('highlight');
    });
}

function clearNodes() {
    document.querySelectorAll('.node').forEach(n => {
        n.classList.remove('highlight', 'blocked', 'attacked');
    });
}

function activateLayers(ids) {
    ids.forEach(id => {
        const el = document.getElementById(id);
        if (el) el.classList.add('active');
    });
}

function clearLayers() {
    document.querySelectorAll('.defense-layer').forEach(l => l.classList.remove('active'));
}

function showTab(name) {
    tabBtns.forEach(b => b.classList.toggle('active', b.dataset.tab === name));
    document.querySelectorAll('.tab-content').forEach(c => {
        c.classList.toggle('active', c.id === `tab-${name}`);
    });
}

function updateExplanation(attack) {
    document.getElementById('whContent').innerHTML = attack.whatsHappening;
    document.getElementById('analogyContent').innerHTML = attack.analogy;
    document.getElementById('whyMatters').innerHTML = attack.whyMatters;
}

function updateCode(attack) {
    document.getElementById('codePlaceholder').style.display = 'none';
    const display = document.getElementById('codeDisplay');
    display.style.display = 'block';
    display.innerHTML = attack.code;
}

function updateFinding(attack) {
    document.getElementById('findingPlaceholder').style.display = 'none';
    const display = document.getElementById('findingDisplay');
    display.style.display = 'block';

    const f = attack.finding;
    display.innerHTML = `
        <div class="finding-card">
            <div class="finding-header">
                <div class="finding-type">${f.type}</div>
                <div class="finding-severity">${f.severity}</div>
            </div>
            <div class="finding-body">
                <div class="finding-title">${f.title}</div>
                <div class="finding-desc">${f.description}</div>
                <div class="finding-json"><pre>${JSON.stringify(f.details, null, 2)}</pre></div>
            </div>
        </div>
    `;
}

function updateResponse(attack) {
    document.getElementById('responsePlaceholder').style.display = 'none';
    const display = document.getElementById('responseDisplay');
    display.style.display = 'block';
    display.innerHTML = attack.response;
}

// ============================================
// MAIN SIMULATION
// ============================================
async function runSimulation(attackId) {
    if (isSimulating) return;
    isSimulating = true;

    const attack = attacks[attackId];
    if (!attack) return;

    // Disable buttons
    attackBtns.forEach(b => b.disabled = true);
    attackBtns.forEach(b => b.classList.toggle('active', b.dataset.attack === attackId));

    // Reset visuals
    clearLog();
    clearNodes();
    clearLayers();
    blockedBanner.classList.remove('show');
    shield.classList.remove('active');
    attacker.classList.remove('active');

    // Update panels
    updateExplanation(attack);
    updateCode(attack);
    updateFinding(attack);
    updateResponse(attack);

    // Start
    log('info', `‚îÅ‚îÅ‚îÅ ${attack.title.toUpperCase()} ‚îÅ‚îÅ‚îÅ`);
    await sleep(400);

    // Show attacker
    attacker.classList.add('active');
    await sleep(500);

    // Highlight targets
    highlightNodes(attack.targetNodes);
    await sleep(300);

    // Run steps
    for (const step of attack.steps) {
        log(step.type, step.msg);

        if (step.type === 'success') {
            activateLayers(attack.defenseLayers);
        }

        await sleep(600);
    }

    // Block effect
    await sleep(300);
    attack.targetNodes.forEach(id => {
        const el = document.getElementById(id);
        if (el) {
            el.classList.remove('highlight');
            el.classList.add('blocked');
        }
    });

    shield.classList.add('active');
    await sleep(300);
    blockedBanner.classList.add('show');

    // Update stats
    attackCount++;
    alertCount++;
    document.getElementById('attacksBlocked').textContent = attackCount;
    document.getElementById('alertsGenerated').textContent = alertCount;

    await sleep(2000);

    // Reset
    blockedBanner.classList.remove('show');
    attacker.classList.remove('active');

    await sleep(400);

    attackBtns.forEach(b => {
        b.disabled = false;
        b.classList.remove('active');
    });

    isSimulating = false;
}

// ============================================
// EVENT LISTENERS
// ============================================
attackBtns.forEach(btn => {
    btn.addEventListener('click', () => runSimulation(btn.dataset.attack));
});

tabBtns.forEach(btn => {
    btn.addEventListener('click', () => showTab(btn.dataset.tab));
});

// Init
log('info', 'Security monitoring active');
log('success', '‚úì All defense layers operational');
</script>

</body>
</html>
